/**
 * mwt.js (v2.5.0)
 * copyright: mawentao
 * released: 2015-09-07 15:45:43
 **/
function hide(eleid){document.getElementById(eleid).style.display ="none";}function display(eleid){document.getElementById(eleid).style.display ="block";}function json2str(o, depth){var result ='';depth || (depth=1);var indent_pre =new Array(4*(depth-1)).join(' ');var indent =new Array(4*depth).join(' ');var tmp ='';var type =typeof o;switch(type){case 'string': case 'number': case 'boolean': case 'undefined': case 'function': tmp +=o;break;case 'object': default: for(var key in o){tmp +=indent + '[' + key + '] = ';tmp +=json2str(o[key], (depth+1));}}if (type =="object"){result +=type + "\n";result +=indent_pre + '(' + "\n";result +=tmp;result +=indent_pre + ')' + "\n";}else {result +=type + "(" + tmp + ")\n";}return result;}function print_r(o){alert(json2str(o));}function get_html(eleid){return document.getElementById(eleid).innerHTML;}function get_value(eleid){var dom =document.getElementById(eleid);return dom.value.trim();}function get_int_value(eleid, dafult_value){var dom =document.getElementById(eleid);var val =parseInt(dom.value);if (isNaN(val)){dom.value =dafult_value;val =dafult_value;}return val;}function get_text_value(eleid){var dom =document.getElementById(eleid);var val =dom.value.trim();if (val ==""){dom.value ="";dom.focus();throw new Error(eleid+" is empty");}return val;}function get_textarea_values(eleid){var str =get_text_value(eleid);var arr =str.split("\n");var res =[];for (var i=0;i<arr.length;++i){var v =arr[i].trim();if (v ==""){continue;}v =encodeURIComponent(v);res.push(v);}return res;}function get_radio_value(elename){var radios =document.getElementsByName(elename);var result;for(var i=0;i<radios.length;i=i+1){if(radios[i].checked ==true){result =radios[i].value;break;}}return result;}function get_select_value(eleid){var sel =document.getElementById(eleid);return sel.options[sel.selectedIndex].value;}function get_checkbox_values(elename){var values =[];var doms =document.getElementsByName(elename);for (var i=0;i<doms.length;++i){if (doms[i].checked){values.push(doms[i].value);}}return values;}function set_html(eleid, value){document.getElementById(eleid).innerHTML =value;}function set_value(eleid, value){document.getElementById(eleid).value =value;}function set_select_value(eleid, value){var sel =document.getElementById(eleid);for(var i=0;i<sel.options.length;i=i+1){if(sel.options[i].value ==value){sel.options[i].selected =true;break;}}}function set_radio_value(elename, value){var doms =document.getElementsByName(elename);for (var i=0;i<doms.length;++i){if (doms[i].value ==value){doms[i].checked =true;return;}}}function set_checkbox_checked(elename, checked){var doms =document.getElementsByName(elename);for (var i=0;i<doms.length;++i){doms[i].checked =checked;}}function set_checkbox_values(elename, varr){var doms =document.getElementsByName(elename);for (var i=0;i<doms.length;++i){var checked =false;for (var k=0;k<varr.length;++k){if (varr[k] ==doms[i].value){checked =true;break;}}doms[i].checked =checked;}}Array.prototype.remove=function(dx){if(isNaN(dx)||dx>this.length){return false;}for(var i=0,n=0;i<this.length;i++){if(this[i]!=this[dx]){this[n++]=this[i];}}this.length-=1;};String.prototype.startWith=function(str, ignoreCase){var reg =eval("/^"+str+"/");if (ignoreCase)reg =eval("/^"+str+"/i");return reg.test(this);};String.prototype.startwith=function(str, ignoreCase){var reg =eval("/^"+str+"/");if (ignoreCase)reg =eval("/^"+str+"/i");return reg.test(this);};String.prototype.endWith=function(str, ignoreCase){var reg =eval("/"+str+"$/");if (ignoreCase)reg =eval("/"+str+"$/i");return reg.test(this);};String.prototype.endwith=function(str, ignoreCase){var reg =eval("/"+str+"$/");if (ignoreCase)reg =eval("/"+str+"$/i");return reg.test(this);};String.prototype.replaceAll=function(olds, news){return this.replace(new RegExp(olds,"gm"), news);};Date.prototype.format=function(fmt){var Y =this.getFullYear();var m =this.getMonth()+1;if (m <10)m ="0"+m;var d =this.getDate();if (d <10)d ="0"+d;var H =this.getHours();if (H <10)H ="0"+H;var i =this.getMinutes();if (i <10)i ="0"+i;var s =this.getSeconds();if (s <10)s ="0"+s;return fmt.replace(/Y/g, Y). replace(/m/g, m). replace(/d/g, d). replace(/H/g, H). replace(/i/g, i). replace(/s/g, s);};function is_number(num){var reg=/^[0-9]+$/;return reg.test(num);};function is_decimal(num){var reg=/^[0-9]+[\.]{0,1}[0-9]*$/;return reg.test(num);};function implode(str, arr){var res="";var con="";for (var i=0;i<arr.length;++i){res+=con+arr[i];con=str;}return res;};function in_array(value, arr){var len=arr.length;for (var i=0;i<len;++i)if (arr[i]==value)return true;return false;};function isset(v){return typeof(v)!="undefined";};function array_keys(o){var res=[];for (var key in o)res.push(key);return res;};function hasClass(ele,cls){return ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));};function addClass(ele,cls){if (!this.hasClass(ele,cls))ele.className +=" "+cls;};function removeClass(ele,cls){if (hasClass(ele,cls)){var reg =new RegExp('(\\s|^)'+cls+'(\\s|$)');ele.className=ele.className.replace(reg,'');}};var MWT={};MWT.show_loading =function(){};MWT.hide_loading =function(){};MWT.extends=function(A,B){A.prototype =new B();};MWT.Event=function(){this.listeners={};this.addListener=function(ename, func){if (!this.listeners[ename]){this.listeners[ename]=[];}for (var i=0;i<this.listeners[ename].length;++i){if (func==this.listeners[ename][i])return;}this.listeners[ename].push(func);};this.on=function(ename, func){this.addListener(ename, func);};this.fireon=function(ename, func){this.addListener(ename, func);func.call(func, this);};this.removeListener=function(ename, func){if (!this.listeners[ename]){return;}var arr=this.listeners[ename];for (var i=0;i<arr.length;++i){if (arr[i]==func){arr.remove(i);return;}}};this.un=function(ename,func){this.removeListener(ename, func);};this.removeAllListeners=function(ename){delete this.listeners[ename];};this.unall=function(ename){this.removeAllListeners(ename);};this.fireEvent=function(ename){if (!this.listeners[ename]){return;}var arr=this.listeners[ename];for (var i=0;i<arr.length;++i){var fun=arr[i];fun.call(fun, this);}};this.fire=function(ename){this.fireEvent(ename);};};MWT.Store=function(cnf){this.listeners ={};this.url="";this.baseParams={};this.totalProperty=0;this.root=[];this.annex={};if (cnf){if (cnf.url)this.url=cnf.url;}this.size=function(){return this.root.length;};this.get=function(index){return this.root[index];};this.indexOf=function(key,value){var n=this.root.length;if (typeof value=="undefined"){for (var i=0;i<n;++i)if (this.root[i]==key)return i;}else {for (var i=0;i<n;++i)if (this.root[i][key]==value)return i;}return -1;};this.push=function(item){this.root.push(item);this.fire("load");};this.insert=function(index,item){this.root.splice(index,0,item);this.fire("load");};this.remove=function(index){this.root.splice(index,1);this.fire("load");};this.pop=function(index){this.root.pop();this.fire("load");};this.clear=function(){this.root=[];this.fire("load");};this.set=function(index,item){this.root[index]=item;this.fire("load");};this.load=function(data){if (data){this.root=data;this.totalProperty=data.length;this.fire("load");}else {var thiso=this;MWT.show_loading();jQuery.ajax({type: "post", async: true, url: this.url, data: this.baseParams, dataType: "json", success: function (res){MWT.hide_loading();thiso.totalProperty=res.totalProperty;thiso.root=res.root;if (isset(res.annex))thiso.annex=res.annex;thiso.fire("load");}, error: function(XMLHttpRequest, textStatus, errorThrown){MWT.hide_loading();var errmsg ="Error("+XMLHttpRequest.readyState+") : "+textStatus;alert(errmsg);}});}};this.sort=function(key, dir){this.baseParams["sort"]=key;this.baseParams["dir"] =dir;this.load();};};MWT.extends(MWT.Store, MWT.Event);MWT.Pagebar=function(cnf){this.listeners ={};this.store={};this.render=null;this.pageNumCount=10;this.pageSizeList=[10,20,50,100,200,500,1000];this.start=0;this.pageSize=10;this.pageNum=0;this.pageCount=0;this.totalProperty=0;if (cnf){if (cnf.render)this.render=cnf.render;if (cnf.pageSize)this.pageSize=cnf.pageSize;if (cnf.pageSizeList)this.pageSizeList=cnf.pageSizeList;if (cnf.store){this.store=cnf.store;var thiso=this;this.store.on("load", function(s){thiso.totalProperty=s.totalProperty;thiso.pageNum=(thiso.start/thiso.pageSize)+ 1;thiso.pageCount=Math.ceil(s.totalProperty/thiso.pageSize);thiso.fire("load");thiso.display();});}}this.changePage=function(pn){var pagenumer=pn>0 ? pn-1 : 0;this.start=pagenumer * this.pageSize;this.store.baseParams["start"]=this.start;this.store.baseParams["limit"]=this.pageSize;this.store.load();};this.changePagesize=function(size){this.pageSize=size;this.changePage(1);};this.nextPage=function(){var page=this.pageNum + 1;if (page >this.pageCount){page=this.pageNum;}this.changePage(page);};this.prevPage=function(){var page=this.pageNum - 1;if (page <1){page=1;}this.changePage(page);};this.firstPage=function(){this.changePage(1);};this.lastPage=function(){this.changePage(this.pageCount);};this.display=function(){if (this.render){var thiso=this;var selid=this.render+"-sel";var pname=this.render+"-page";var code="<table class='tablay' style='margin-top:3px;'><tr><td>";var list_heaad=[ {"text":"首页", "value":1, "active":this.pageNum!=1}, {"text":"上一页", "value":this.pageNum-1, "active":this.pageNum!=1}];var list_body=[];var step=Math.ceil(this.pageNumCount / 2);var begin=this.pageNum - step;if (begin<1)begin=1;var count=0;while (count <this.pageNumCount){var active=(begin!=this.pageNum);var item={"text":begin, "value":begin, "active":active};list_body.push(item);++begin;if (begin >this.pageCount)break;++count;}var list_tail=[ {"text":"下一页", "value":this.pageNum+1, "active":(this.pageCount>0)&(this.pageNum!=this.pageCount)}, {"text":"尾页", "value":this.pageCount, "active":(this.pageCount>0)&(this.pageNum!=this.pageCount)}];var list=list_heaad.concat(list_body, list_tail);for (var i=0;i<list.length;++i){var t=list[i].text;var v=list[i].value;var c=list[i].active ? "" : "disabled";var margin_left =(i==0)? 0 : 1;code +="<button name='"+pname+"' "+c+" value='"+v+"' "+ "class='mwt-btn mwt-btn-default mwt-btn-xs' style='border-radius:0;margin-left:"+margin_left+"px;'>"+t+ "</button>";}code +="</td><td style='text-align:right;font-size:12px;'>"+ "共 <b>"+this.totalProperty+"</b> 条记录，每页显示个数：<select id='"+selid+"'>";for (var i=0;i<this.pageSizeList.length;++i){var v=this.pageSizeList[i];var c=v==this.pageSize ? "selected" : "";code+="<option value='"+v+"' "+c+">"+v+"</option>";}code +="</select>";code +="</td></tr></table>";document.getElementById(this.render).innerHTML=code;document.getElementById(selid).onchange=function(e){thiso.changePagesize(this.value);};var btns=document.getElementsByName(pname);for (var i=0;i<btns.length;++i){btns[i].onclick=function(e){thiso.changePage(this.value);};}}};};MWT.extends(MWT.Pagebar, MWT.Event);MWT.Field=function(opt){this.listeners={};this.render=null;this.id="";this.value="";this.defaultValue="";this.cls="";this.style="";this.construct=function(opt){if (opt){if(isset(opt.render))this.render=opt.render;if(isset(opt.id))this.id=opt.id;if(isset(opt.value))this.value=opt.value;if(isset(opt.style))this.style=opt.style;if(isset(opt.cls))this.cls=opt.cls;this.defaultValue=this.value;}};this.getId=function(){return this.id;};this.getValue=function(){return this.value;};this.reset=function(){this.value=this.defaultValue;this.setValue(this.defaultValue);};};MWT.extends(MWT.Field, MWT.Event);(function(factory ){if (typeof define ==="function" && define.amd ){define([ "jquery" ], factory );}else {factory(jQuery );}}(function($ ){$.ui =$.ui || {};$.extend($.ui, {version: "1.11.4", keyCode: {BACKSPACE: 8, COMMA: 188, DELETE: 46, DOWN: 40, END: 35, ENTER: 13, ESCAPE: 27, HOME: 36, LEFT: 37, PAGE_DOWN: 34, PAGE_UP: 33, PERIOD: 190, RIGHT: 39, SPACE: 32, TAB: 9, UP: 38 }});$.fn.extend({scrollParent: function(includeHidden ){var position =this.css("position" ), excludeStaticParent =position ==="absolute", overflowRegex =includeHidden ? /(auto|scroll|hidden)/ : /(auto|scroll)/, scrollParent =this.parents().filter(function(){var parent =$(this );if (excludeStaticParent && parent.css("position" )==="static" ){return false;}return overflowRegex.test(parent.css("overflow" )+ parent.css("overflow-y" )+ parent.css("overflow-x" ));}).eq(0 );return position ==="fixed" || !scrollParent.length ? $(this[ 0 ].ownerDocument || document ): scrollParent;}, uniqueId: (function(){var uuid =0;return function(){return this.each(function(){if (!this.id ){this.id ="ui-id-" + (++uuid );}});};})(), removeUniqueId: function(){return this.each(function(){if (/^ui-id-\d+$/.test(this.id )){$(this ).removeAttr("id" );}});}});function focusable(element, isTabIndexNotNaN ){var map, mapName, img, nodeName =element.nodeName.toLowerCase();if ("area" ===nodeName ){map =element.parentNode;mapName =map.name;if (!element.href || !mapName || map.nodeName.toLowerCase()!=="map" ){return false;}img =$("img[usemap='#" + mapName + "']" )[ 0 ];return !!img && visible(img );}return (/^(input|select|textarea|button|object)$/.test(nodeName )? !element.disabled : "a" ===nodeName ? element.href || isTabIndexNotNaN : isTabIndexNotNaN)&& visible(element );}function visible(element ){return $.expr.filters.visible(element )&& !$(element ).parents().addBack().filter(function(){return $.css(this, "visibility" )==="hidden";}).length;}$.extend($.expr[ ":" ], {data: $.expr.createPseudo ? $.expr.createPseudo(function(dataName ){return function(elem ){return !!$.data(elem, dataName );};}): function(elem, i, match ){return !!$.data(elem, match[ 3 ] );}, focusable: function(element ){return focusable(element, !isNaN($.attr(element, "tabindex" )));}, tabbable: function(element ){var tabIndex =$.attr(element, "tabindex" ), isTabIndexNaN =isNaN(tabIndex );return (isTabIndexNaN || tabIndex >=0 )&& focusable(element, !isTabIndexNaN );}});if (!$("<a>" ).outerWidth(1 ).jquery ){$.each([ "Width", "Height" ], function(i, name ){var side =name ==="Width" ? [ "Left", "Right" ] : [ "Top", "Bottom" ], type =name.toLowerCase(), orig ={innerWidth: $.fn.innerWidth, innerHeight: $.fn.innerHeight, outerWidth: $.fn.outerWidth, outerHeight: $.fn.outerHeight };function reduce(elem, size, border, margin ){$.each(side, function(){size -=parseFloat($.css(elem, "padding" + this ))|| 0;if (border ){size -=parseFloat($.css(elem, "border" + this + "Width" ))|| 0;}if (margin ){size -=parseFloat($.css(elem, "margin" + this ))|| 0;}});return size;}$.fn[ "inner" + name ] =function(size ){if (size ===undefined ){return orig[ "inner" + name ].call(this );}return this.each(function(){$(this ).css(type, reduce(this, size )+ "px" );});};$.fn[ "outer" + name] =function(size, margin ){if (typeof size !=="number" ){return orig[ "outer" + name ].call(this, size );}return this.each(function(){$(this).css(type, reduce(this, size, true, margin )+ "px" );});};});}if (!$.fn.addBack ){$.fn.addBack =function(selector ){return this.add(selector ==null ? this.prevObject : this.prevObject.filter(selector ));};}if ($("<a>" ).data("a-b", "a" ).removeData("a-b" ).data("a-b" )){$.fn.removeData =(function(removeData ){return function(key ){if (arguments.length ){return removeData.call(this, $.camelCase(key ));}else {return removeData.call(this );}};})($.fn.removeData );}$.ui.ie =!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());$.fn.extend({focus: (function(orig ){return function(delay, fn ){return typeof delay ==="number" ? this.each(function(){var elem =this;setTimeout(function(){$(elem ).focus();if (fn ){fn.call(elem );}}, delay );}): orig.apply(this, arguments );};})($.fn.focus ), disableSelection: (function(){var eventType ="onselectstart" in document.createElement("div" )? "selectstart" : "mousedown";return function(){return this.bind(eventType + ".ui-disableSelection", function(event ){event.preventDefault();});};})(), enableSelection: function(){return this.unbind(".ui-disableSelection" );}, zIndex: function(zIndex ){if (zIndex !==undefined ){return this.css("zIndex", zIndex );}if (this.length ){var elem =$(this[ 0 ] ), position, value;while (elem.length && elem[ 0 ] !==document ){position =elem.css("position" );if (position ==="absolute" || position ==="relative" || position ==="fixed" ){value =parseInt(elem.css("zIndex" ), 10 );if (!isNaN(value )&& value !==0 ){return value;}}elem =elem.parent();}}return 0;}});$.ui.plugin ={add: function(module, option, set ){var i, proto =$.ui[ module ].prototype;for (i in set ){proto.plugins[ i ] =proto.plugins[ i ] || [];proto.plugins[ i ].push([ option, set[ i ] ] );}}, call: function(instance, name, args, allowDisconnected ){var i, set =instance.plugins[ name ];if (!set ){return;}if (!allowDisconnected && (!instance.element[ 0 ].parentNode || instance.element[ 0 ].parentNode.nodeType ===11 )){return;}for (i =0;i <set.length;i++ ){if (instance.options[ set[ i ][ 0 ] ] ){set[ i ][ 1 ].apply(instance.element, args );}}}};$.extend($.ui, {datepicker: {version: "1.11.4" }});var datepicker_instActive;function datepicker_getZindex(elem ){var position, value;while (elem.length && elem[ 0 ] !==document ){position =elem.css("position" );if (position ==="absolute" || position ==="relative" || position ==="fixed" ){value =parseInt(elem.css("zIndex" ), 10 );if (!isNaN(value )&& value !==0 ){return value;}}elem =elem.parent();}return 0;}function Datepicker(){this._curInst =null;this._keyEvent =false;this._disabledInputs =[];this._datepickerShowing =false;this._inDialog =false;this._mainDivId ="ui-datepicker-div";this._inlineClass ="ui-datepicker-inline";this._appendClass ="ui-datepicker-append";this._triggerClass ="ui-datepicker-trigger";this._dialogClass ="ui-datepicker-dialog";this._disableClass ="ui-datepicker-disabled";this._unselectableClass ="ui-datepicker-unselectable";this._currentClass ="ui-datepicker-current-day";this._dayOverClass ="ui-datepicker-days-cell-over";this.regional =[];this.regional[""] ={closeText: "确认", prevText: "上月", nextText: "下月", currentText: "Today", monthNames: ['一月','二月','三月','四月','五月','六月','七月','八月','九月','十月','十一月','十二月'], monthNamesShort: ['一月','二月','三月','四月','五月','六月','七月','八月','九月','十月','十一月','十二月'], dayNames: ['星期日','星期一','星期二','星期三','星期四','星期五','星期六'], dayNamesShort: ['周日','周一','周二','周三','周四','周五','周六'], dayNamesMin: ['日','一','二','三','四','五','六'], weekHeader: "Wk", dateFormat: "yy/mm/dd", firstDay: 0, isRTL: false, showMonthAfterYear: true, yearSuffix: "年" };this._defaults ={showOn: "focus", showAnim: "fadeIn", showOptions: {}, defaultDate: null, appendText: "", buttonText: "...", buttonImage: "", buttonImageOnly: false, hideIfNoPrevNext: false, navigationAsDateFormat: false, gotoCurrent: false, changeMonth: false, changeYear: false, yearRange: "c-10:c+10", showOtherMonths: false, selectOtherMonths: false, showWeek: false, calculateWeek: this.iso8601Week, shortYearCutoff: "+10", minDate: null, maxDate: null, duration: "fast", beforeShowDay: null, beforeShow: null, onSelect: null, onChangeMonthYear: null, onClose: null, numberOfMonths: 1, showCurrentAtPos: 0, stepMonths: 1, stepBigMonths: 12, altField: "", altFormat: "", constrainInput: true, showButtonPanel: false, autoSize: false, disabled: false };$.extend(this._defaults, this.regional[""]);this.regional.en =$.extend(true, {}, this.regional[ "" ]);this.regional[ "en-US" ] =$.extend(true, {}, this.regional.en );this.dpDiv =datepicker_bindHover($("<div id='" + this._mainDivId + "' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"));}$.extend(Datepicker.prototype, {markerClassName: "hasDatepicker", maxRows: 4, _widgetDatepicker: function(){return this.dpDiv;}, setDefaults: function(settings){datepicker_extendRemove(this._defaults, settings || {});return this;}, _attachDatepicker: function(target, settings){var nodeName, inline, inst;nodeName =target.nodeName.toLowerCase();inline =(nodeName ==="div" || nodeName ==="span");if (!target.id){this.uuid +=1;target.id ="dp" + this.uuid;}inst =this._newInst($(target), inline);inst.settings =$.extend({}, settings || {});if (nodeName ==="input"){this._connectDatepicker(target, inst);}else if (inline){this._inlineDatepicker(target, inst);}}, _newInst: function(target, inline){var id =target[0].id.replace(/([^A-Za-z0-9_\-])/g, "\\\\$1");return {id: id, input: target, selectedDay: 0, selectedMonth: 0, selectedYear: 0, drawMonth: 0, drawYear: 0, inline: inline, dpDiv: (!inline ? this.dpDiv : datepicker_bindHover($("<div class='" + this._inlineClass + " ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")))};}, _connectDatepicker: function(target, inst){var input =$(target);inst.append =$([]);inst.trigger =$([]);if (input.hasClass(this.markerClassName)){return;}this._attachments(input, inst);input.addClass(this.markerClassName).keydown(this._doKeyDown). keypress(this._doKeyPress).keyup(this._doKeyUp);this._autoSize(inst);$.data(target, "datepicker", inst);if(inst.settings.disabled ){this._disableDatepicker(target );}}, _attachments: function(input, inst){var showOn, buttonText, buttonImage, appendText =this._get(inst, "appendText"), isRTL =this._get(inst, "isRTL");if (inst.append){inst.append.remove();}if (appendText){inst.append =$("<span class='" + this._appendClass + "'>" + appendText + "</span>");input[isRTL ? "before" : "after"](inst.append);}input.unbind("focus", this._showDatepicker);if (inst.trigger){inst.trigger.remove();}showOn =this._get(inst, "showOn");if (showOn ==="focus" || showOn ==="both"){input.focus(this._showDatepicker);}if (showOn ==="button" || showOn ==="both"){buttonText =this._get(inst, "buttonText");buttonImage =this._get(inst, "buttonImage");inst.trigger =$(this._get(inst, "buttonImageOnly")? $("<img/>").addClass(this._triggerClass). attr({src: buttonImage, alt: buttonText, title: buttonText }): $("<button type='button'></button>").addClass(this._triggerClass). html(!buttonImage ? buttonText : $("<img/>").attr({src:buttonImage, alt:buttonText, title:buttonText })));input[isRTL ? "before" : "after"](inst.trigger);inst.trigger.click(function(){if ($.datepicker._datepickerShowing && $.datepicker._lastInput ===input[0]){$.datepicker._hideDatepicker();}else if ($.datepicker._datepickerShowing && $.datepicker._lastInput !==input[0]){$.datepicker._hideDatepicker();$.datepicker._showDatepicker(input[0]);}else {$.datepicker._showDatepicker(input[0]);}return false;});}}, _autoSize: function(inst){if (this._get(inst, "autoSize")&& !inst.inline){var findMax, max, maxI, i, date =new Date(2009, 12 - 1, 20), dateFormat =this._get(inst, "dateFormat");if (dateFormat.match(/[DM]/)){findMax =function(names){max =0;maxI =0;for (i =0;i <names.length;i++){if (names[i].length >max){max =names[i].length;maxI =i;}}return maxI;};date.setMonth(findMax(this._get(inst, (dateFormat.match(/MM/)? "monthNames" : "monthNamesShort"))));date.setDate(findMax(this._get(inst, (dateFormat.match(/DD/)? "dayNames" : "dayNamesShort")))+ 20 - date.getDay());}inst.input.attr("size", this._formatDate(inst, date).length);}}, _inlineDatepicker: function(target, inst){var divSpan =$(target);if (divSpan.hasClass(this.markerClassName)){return;}divSpan.addClass(this.markerClassName).append(inst.dpDiv);$.data(target, "datepicker", inst);this._setDate(inst, this._getDefaultDate(inst), true);this._updateDatepicker(inst);this._updateAlternate(inst);if(inst.settings.disabled ){this._disableDatepicker(target );}inst.dpDiv.css("display", "block" );}, _dialogDatepicker: function(input, date, onSelect, settings, pos){var id, browserWidth, browserHeight, scrollX, scrollY, inst =this._dialogInst;if (!inst){this.uuid +=1;id ="dp" + this.uuid;this._dialogInput =$("<input type='text' id='" + id + "' style='position: absolute; top: -100px; width: 0px;'/>");this._dialogInput.keydown(this._doKeyDown);$("body").append(this._dialogInput);inst =this._dialogInst =this._newInst(this._dialogInput, false);inst.settings ={};$.data(this._dialogInput[0], "datepicker", inst);}datepicker_extendRemove(inst.settings, settings || {});date =(date && date.constructor ===Date ? this._formatDate(inst, date): date);this._dialogInput.val(date);this._pos =(pos ? (pos.length ? pos : [pos.pageX, pos.pageY]): null);if (!this._pos){browserWidth =document.documentElement.clientWidth;browserHeight =document.documentElement.clientHeight;scrollX =document.documentElement.scrollLeft || document.body.scrollLeft;scrollY =document.documentElement.scrollTop || document.body.scrollTop;this._pos =[(browserWidth / 2)- 100 + scrollX, (browserHeight / 2)- 150 + scrollY];}this._dialogInput.css("left", (this._pos[0] + 20)+ "px").css("top", this._pos[1] + "px");inst.settings.onSelect =onSelect;this._inDialog =true;this.dpDiv.addClass(this._dialogClass);this._showDatepicker(this._dialogInput[0]);if ($.blockUI){$.blockUI(this.dpDiv);}$.data(this._dialogInput[0], "datepicker", inst);return this;}, _destroyDatepicker: function(target){var nodeName, $target =$(target), inst =$.data(target, "datepicker");if (!$target.hasClass(this.markerClassName)){return;}nodeName =target.nodeName.toLowerCase();$.removeData(target, "datepicker");if (nodeName ==="input"){inst.append.remove();inst.trigger.remove();$target.removeClass(this.markerClassName). unbind("focus", this._showDatepicker). unbind("keydown", this._doKeyDown). unbind("keypress", this._doKeyPress). unbind("keyup", this._doKeyUp);}else if (nodeName ==="div" || nodeName ==="span"){$target.removeClass(this.markerClassName).empty();}if (datepicker_instActive ===inst ){datepicker_instActive =null;}}, _enableDatepicker: function(target){var nodeName, inline, $target =$(target), inst =$.data(target, "datepicker");if (!$target.hasClass(this.markerClassName)){return;}nodeName =target.nodeName.toLowerCase();if (nodeName ==="input"){target.disabled =false;inst.trigger.filter("button"). each(function(){this.disabled =false;}).end(). filter("img").css({opacity: "1.0", cursor: ""});}else if (nodeName ==="div" || nodeName ==="span"){inline =$target.children("." + this._inlineClass);inline.children().removeClass("ui-state-disabled");inline.find("select.ui-datepicker-month, select.ui-datepicker-year"). prop("disabled", false);}this._disabledInputs =$.map(this._disabledInputs, function(value){return (value ===target ? null : value);});}, _disableDatepicker: function(target){var nodeName, inline, $target =$(target), inst =$.data(target, "datepicker");if (!$target.hasClass(this.markerClassName)){return;}nodeName =target.nodeName.toLowerCase();if (nodeName ==="input"){target.disabled =true;inst.trigger.filter("button"). each(function(){this.disabled =true;}).end(). filter("img").css({opacity: "0.5", cursor: "default"});}else if (nodeName ==="div" || nodeName ==="span"){inline =$target.children("." + this._inlineClass);inline.children().addClass("ui-state-disabled");inline.find("select.ui-datepicker-month, select.ui-datepicker-year"). prop("disabled", true);}this._disabledInputs =$.map(this._disabledInputs, function(value){return (value ===target ? null : value);});this._disabledInputs[this._disabledInputs.length] =target;}, _isDisabledDatepicker: function(target){if (!target){return false;}for (var i =0;i <this._disabledInputs.length;i++){if (this._disabledInputs[i] ===target){return true;}}return false;}, _getInst: function(target){try {return $.data(target, "datepicker");}catch (err){throw "Missing instance data for this datepicker";}}, _optionDatepicker: function(target, name, value){var settings, date, minDate, maxDate, inst =this._getInst(target);if (arguments.length ===2 && typeof name ==="string"){return (name ==="defaults" ? $.extend({}, $.datepicker._defaults): (inst ? (name ==="all" ? $.extend({}, inst.settings): this._get(inst, name)): null));}settings =name || {};if (typeof name ==="string"){settings ={};settings[name] =value;}if (inst){if (this._curInst ===inst){this._hideDatepicker();}date =this._getDateDatepicker(target, true);minDate =this._getMinMaxDate(inst, "min");maxDate =this._getMinMaxDate(inst, "max");datepicker_extendRemove(inst.settings, settings);if (minDate !==null && settings.dateFormat !==undefined && settings.minDate ===undefined){inst.settings.minDate =this._formatDate(inst, minDate);}if (maxDate !==null && settings.dateFormat !==undefined && settings.maxDate ===undefined){inst.settings.maxDate =this._formatDate(inst, maxDate);}if ("disabled" in settings ){if (settings.disabled ){this._disableDatepicker(target);}else {this._enableDatepicker(target);}}this._attachments($(target), inst);this._autoSize(inst);this._setDate(inst, date);this._updateAlternate(inst);this._updateDatepicker(inst);}}, _changeDatepicker: function(target, name, value){this._optionDatepicker(target, name, value);}, _refreshDatepicker: function(target){var inst =this._getInst(target);if (inst){this._updateDatepicker(inst);}}, _setDateDatepicker: function(target, date){var inst =this._getInst(target);if (inst){this._setDate(inst, date);this._updateDatepicker(inst);this._updateAlternate(inst);}}, _getDateDatepicker: function(target, noDefault){var inst =this._getInst(target);if (inst && !inst.inline){this._setDateFromField(inst, noDefault);}return (inst ? this._getDate(inst): null);}, _doKeyDown: function(event){var onSelect, dateStr, sel, inst =$.datepicker._getInst(event.target), handled =true, isRTL =inst.dpDiv.is(".ui-datepicker-rtl");inst._keyEvent =true;if ($.datepicker._datepickerShowing){switch (event.keyCode){case 9: $.datepicker._hideDatepicker();handled =false;break;case 13: sel =$("td." + $.datepicker._dayOverClass + ":not(." + $.datepicker._currentClass + ")", inst.dpDiv);if (sel[0]){$.datepicker._selectDay(event.target, inst.selectedMonth, inst.selectedYear, sel[0]);}onSelect =$.datepicker._get(inst, "onSelect");if (onSelect){dateStr =$.datepicker._formatDate(inst);onSelect.apply((inst.input ? inst.input[0] : null), [dateStr, inst]);}else {$.datepicker._hideDatepicker();}return false;case 27: $.datepicker._hideDatepicker();break;case 33: $.datepicker._adjustDate(event.target, (event.ctrlKey ? -$.datepicker._get(inst, "stepBigMonths"): -$.datepicker._get(inst, "stepMonths")), "M");break;case 34: $.datepicker._adjustDate(event.target, (event.ctrlKey ? +$.datepicker._get(inst, "stepBigMonths"): +$.datepicker._get(inst, "stepMonths")), "M");break;case 35: if (event.ctrlKey || event.metaKey){$.datepicker._clearDate(event.target);}handled =event.ctrlKey || event.metaKey;break;case 36: if (event.ctrlKey || event.metaKey){$.datepicker._gotoToday(event.target);}handled =event.ctrlKey || event.metaKey;break;case 37: if (event.ctrlKey || event.metaKey){$.datepicker._adjustDate(event.target, (isRTL ? +1 : -1), "D");}handled =event.ctrlKey || event.metaKey;if (event.originalEvent.altKey){$.datepicker._adjustDate(event.target, (event.ctrlKey ? -$.datepicker._get(inst, "stepBigMonths"): -$.datepicker._get(inst, "stepMonths")), "M");}break;case 38: if (event.ctrlKey || event.metaKey){$.datepicker._adjustDate(event.target, -7, "D");}handled =event.ctrlKey || event.metaKey;break;case 39: if (event.ctrlKey || event.metaKey){$.datepicker._adjustDate(event.target, (isRTL ? -1 : +1), "D");}handled =event.ctrlKey || event.metaKey;if (event.originalEvent.altKey){$.datepicker._adjustDate(event.target, (event.ctrlKey ? +$.datepicker._get(inst, "stepBigMonths"): +$.datepicker._get(inst, "stepMonths")), "M");}break;case 40: if (event.ctrlKey || event.metaKey){$.datepicker._adjustDate(event.target, +7, "D");}handled =event.ctrlKey || event.metaKey;break;default: handled =false;}}else if (event.keyCode ===36 && event.ctrlKey){$.datepicker._showDatepicker(this);}else {handled =false;}if (handled){event.preventDefault();event.stopPropagation();}}, _doKeyPress: function(event){var chars, chr, inst =$.datepicker._getInst(event.target);if ($.datepicker._get(inst, "constrainInput")){chars =$.datepicker._possibleChars($.datepicker._get(inst, "dateFormat"));chr =String.fromCharCode(event.charCode ==null ? event.keyCode : event.charCode);return event.ctrlKey || event.metaKey || (chr <" " || !chars || chars.indexOf(chr)>-1);}}, _doKeyUp: function(event){var date, inst =$.datepicker._getInst(event.target);if (inst.input.val()!==inst.lastVal){try {date =$.datepicker.parseDate($.datepicker._get(inst, "dateFormat"), (inst.input ? inst.input.val(): null), $.datepicker._getFormatConfig(inst));if (date){$.datepicker._setDateFromField(inst);$.datepicker._updateAlternate(inst);$.datepicker._updateDatepicker(inst);}}catch (err){}}return true;}, _showDatepicker: function(input){input =input.target || input;if (input.nodeName.toLowerCase()!=="input"){input =$("input", input.parentNode)[0];}if ($.datepicker._isDisabledDatepicker(input)|| $.datepicker._lastInput ===input){return;}var inst, beforeShow, beforeShowSettings, isFixed, offset, showAnim, duration;inst =$.datepicker._getInst(input);if ($.datepicker._curInst && $.datepicker._curInst !==inst){$.datepicker._curInst.dpDiv.stop(true, true);if (inst && $.datepicker._datepickerShowing ){$.datepicker._hideDatepicker($.datepicker._curInst.input[0] );}}beforeShow =$.datepicker._get(inst, "beforeShow");beforeShowSettings =beforeShow ? beforeShow.apply(input, [input, inst]): {};if(beforeShowSettings ===false){return;}datepicker_extendRemove(inst.settings, beforeShowSettings);inst.lastVal =null;$.datepicker._lastInput =input;$.datepicker._setDateFromField(inst);if ($.datepicker._inDialog){input.value ="";}if (!$.datepicker._pos){$.datepicker._pos =$.datepicker._findPos(input);$.datepicker._pos[1] +=input.offsetHeight;}isFixed =false;$(input).parents().each(function(){isFixed |=$(this).css("position")==="fixed";return !isFixed;});offset ={left: $.datepicker._pos[0], top: $.datepicker._pos[1]};$.datepicker._pos =null;inst.dpDiv.empty();inst.dpDiv.css({position: "absolute", display: "block", top: "-1000px"});$.datepicker._updateDatepicker(inst);offset =$.datepicker._checkOffset(inst, offset, isFixed);inst.dpDiv.css({position: ($.datepicker._inDialog && $.blockUI ? "static" : (isFixed ? "fixed" : "absolute")), display: "none", left: offset.left + "px", top: offset.top + "px"});if (!inst.inline){showAnim =$.datepicker._get(inst, "showAnim");duration =$.datepicker._get(inst, "duration");inst.dpDiv.css("z-index", datepicker_getZindex($(input ))+ 1 );$.datepicker._datepickerShowing =true;if ($.effects && $.effects.effect[ showAnim ] ){inst.dpDiv.show(showAnim, $.datepicker._get(inst, "showOptions"), duration);}else {inst.dpDiv[showAnim || "show"](showAnim ? duration : null);}if ($.datepicker._shouldFocusInput(inst )){inst.input.focus();}$.datepicker._curInst =inst;}}, _updateDatepicker: function(inst){this.maxRows =4;datepicker_instActive =inst;inst.dpDiv.empty().append(this._generateHTML(inst));this._attachHandlers(inst);var origyearshtml, numMonths =this._getNumberOfMonths(inst), cols =numMonths[1], width =17, activeCell =inst.dpDiv.find("." + this._dayOverClass + " a" );if (activeCell.length >0 ){datepicker_handleMouseover.apply(activeCell.get(0 ));}inst.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width("");if (cols >1){inst.dpDiv.addClass("ui-datepicker-multi-" + cols).css("width", (width * cols)+ "em");}inst.dpDiv[(numMonths[0] !==1 || numMonths[1] !==1 ? "add" : "remove")+ "Class"]("ui-datepicker-multi");inst.dpDiv[(this._get(inst, "isRTL")? "add" : "remove")+ "Class"]("ui-datepicker-rtl");if (inst ===$.datepicker._curInst && $.datepicker._datepickerShowing && $.datepicker._shouldFocusInput(inst )){inst.input.focus();}if(inst.yearshtml ){origyearshtml =inst.yearshtml;setTimeout(function(){if(origyearshtml ===inst.yearshtml && inst.yearshtml ){inst.dpDiv.find("select.ui-datepicker-year:first").replaceWith(inst.yearshtml);}origyearshtml =inst.yearshtml =null;}, 0);}}, _shouldFocusInput: function(inst ){return inst.input && inst.input.is(":visible" )&& !inst.input.is(":disabled" )&& !inst.input.is(":focus" );}, _checkOffset: function(inst, offset, isFixed){var dpWidth =inst.dpDiv.outerWidth(), dpHeight =inst.dpDiv.outerHeight(), inputWidth =inst.input ? inst.input.outerWidth(): 0, inputHeight =inst.input ? inst.input.outerHeight(): 0, viewWidth =document.documentElement.clientWidth + (isFixed ? 0 : $(document).scrollLeft()), viewHeight =document.documentElement.clientHeight + (isFixed ? 0 : $(document).scrollTop());offset.left -=(this._get(inst, "isRTL")? (dpWidth - inputWidth): 0);offset.left -=(isFixed && offset.left ===inst.input.offset().left)? $(document).scrollLeft(): 0;offset.top -=(isFixed && offset.top ===(inst.input.offset().top + inputHeight))? $(document).scrollTop(): 0;offset.left -=Math.min(offset.left, (offset.left + dpWidth >viewWidth && viewWidth >dpWidth)? Math.abs(offset.left + dpWidth - viewWidth): 0);offset.top -=Math.min(offset.top, (offset.top + dpHeight >viewHeight && viewHeight >dpHeight)? Math.abs(dpHeight + inputHeight): 0);return offset;}, _findPos: function(obj){var position, inst =this._getInst(obj), isRTL =this._get(inst, "isRTL");while (obj && (obj.type ==="hidden" || obj.nodeType !==1 || $.expr.filters.hidden(obj))){obj =obj[isRTL ? "previousSibling" : "nextSibling"];}position =$(obj).offset();return [position.left, position.top];}, _hideDatepicker: function(input){var showAnim, duration, postProcess, onClose, inst =this._curInst;if (!inst || (input && inst !==$.data(input, "datepicker"))){return;}if (this._datepickerShowing){showAnim =this._get(inst, "showAnim");duration =this._get(inst, "duration");postProcess =function(){$.datepicker._tidyDialog(inst);};if ($.effects && ($.effects.effect[ showAnim ] || $.effects[ showAnim ] )){inst.dpDiv.hide(showAnim, $.datepicker._get(inst, "showOptions"), duration, postProcess);}else {inst.dpDiv[(showAnim ==="slideDown" ? "slideUp" : (showAnim ==="fadeIn" ? "fadeOut" : "hide"))]((showAnim ? duration : null), postProcess);}if (!showAnim){postProcess();}this._datepickerShowing =false;onClose =this._get(inst, "onClose");if (onClose){onClose.apply((inst.input ? inst.input[0] : null), [(inst.input ? inst.input.val(): ""), inst]);}this._lastInput =null;if (this._inDialog){this._dialogInput.css({position: "absolute", left: "0", top: "-100px" });if ($.blockUI){$.unblockUI();$("body").append(this.dpDiv);}}this._inDialog =false;}}, _tidyDialog: function(inst){inst.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar");}, _checkExternalClick: function(event){if (!$.datepicker._curInst){return;}var $target =$(event.target), inst =$.datepicker._getInst($target[0]);if ((($target[0].id !==$.datepicker._mainDivId && $target.parents("#" + $.datepicker._mainDivId).length ===0 && !$target.hasClass($.datepicker.markerClassName)&& !$target.closest("." + $.datepicker._triggerClass).length && $.datepicker._datepickerShowing && !($.datepicker._inDialog && $.blockUI)))|| ($target.hasClass($.datepicker.markerClassName)&& $.datepicker._curInst !==inst )){$.datepicker._hideDatepicker();}}, _adjustDate: function(id, offset, period){var target =$(id), inst =this._getInst(target[0]);if (this._isDisabledDatepicker(target[0])){return;}this._adjustInstDate(inst, offset + (period ==="M" ? this._get(inst, "showCurrentAtPos"): 0), period);this._updateDatepicker(inst);}, _gotoToday: function(id){var date, target =$(id), inst =this._getInst(target[0]);if (this._get(inst, "gotoCurrent")&& inst.currentDay){inst.selectedDay =inst.currentDay;inst.drawMonth =inst.selectedMonth =inst.currentMonth;inst.drawYear =inst.selectedYear =inst.currentYear;}else {date =new Date();inst.selectedDay =date.getDate();inst.drawMonth =inst.selectedMonth =date.getMonth();inst.drawYear =inst.selectedYear =date.getFullYear();}this._notifyChange(inst);this._adjustDate(target);}, _selectMonthYear: function(id, select, period){var target =$(id), inst =this._getInst(target[0]);inst["selected" + (period ==="M" ? "Month" : "Year")] =inst["draw" + (period ==="M" ? "Month" : "Year")] =parseInt(select.options[select.selectedIndex].value,10);this._notifyChange(inst);this._adjustDate(target);}, _selectDay: function(id, month, year, td){var inst, target =$(id);if ($(td).hasClass(this._unselectableClass)|| this._isDisabledDatepicker(target[0])){return;}inst =this._getInst(target[0]);inst.selectedDay =inst.currentDay =$("a", td).html();inst.selectedMonth =inst.currentMonth =month;inst.selectedYear =inst.currentYear =year;this._selectDate(id, this._formatDate(inst, inst.currentDay, inst.currentMonth, inst.currentYear));}, _clearDate: function(id){var target =$(id);this._selectDate(target, "");}, _selectDate: function(id, dateStr){var onSelect, target =$(id), inst =this._getInst(target[0]);dateStr =(dateStr !=null ? dateStr : this._formatDate(inst));if (inst.input){inst.input.val(dateStr);}this._updateAlternate(inst);onSelect =this._get(inst, "onSelect");if (onSelect){onSelect.apply((inst.input ? inst.input[0] : null), [dateStr, inst]);}else if (inst.input){inst.input.trigger("change");}if (inst.inline){this._updateDatepicker(inst);}else {this._hideDatepicker();this._lastInput =inst.input[0];if (typeof(inst.input[0])!=="object"){inst.input.focus();}this._lastInput =null;}}, _updateAlternate: function(inst){var altFormat, date, dateStr, altField =this._get(inst, "altField");if (altField){altFormat =this._get(inst, "altFormat")|| this._get(inst, "dateFormat");date =this._getDate(inst);dateStr =this.formatDate(altFormat, date, this._getFormatConfig(inst));$(altField).each(function(){$(this).val(dateStr);});}}, noWeekends: function(date){var day =date.getDay();return [(day >0 && day <6), ""];}, iso8601Week: function(date){var time, checkDate =new Date(date.getTime());checkDate.setDate(checkDate.getDate()+ 4 - (checkDate.getDay()|| 7));time =checkDate.getTime();checkDate.setMonth(0);checkDate.setDate(1);return Math.floor(Math.round((time - checkDate)/ 86400000)/ 7)+ 1;}, parseDate: function (format, value, settings){if (format ==null || value ==null){throw "Invalid arguments";}value =(typeof value ==="object" ? value.toString(): value + "");if (value ===""){return null;}var iFormat, dim, extra, iValue =0, shortYearCutoffTemp =(settings ? settings.shortYearCutoff : null)|| this._defaults.shortYearCutoff, shortYearCutoff =(typeof shortYearCutoffTemp !=="string" ? shortYearCutoffTemp : new Date().getFullYear()% 100 + parseInt(shortYearCutoffTemp, 10)), dayNamesShort =(settings ? settings.dayNamesShort : null)|| this._defaults.dayNamesShort, dayNames =(settings ? settings.dayNames : null)|| this._defaults.dayNames, monthNamesShort =(settings ? settings.monthNamesShort : null)|| this._defaults.monthNamesShort, monthNames =(settings ? settings.monthNames : null)|| this._defaults.monthNames, year =-1, month =-1, day =-1, doy =-1, literal =false, date, lookAhead =function(match){var matches =(iFormat + 1 <format.length && format.charAt(iFormat + 1)===match);if (matches){iFormat++;}return matches;}, getNumber =function(match){var isDoubled =lookAhead(match), size =(match ==="@" ? 14 : (match ==="!" ? 20 : (match ==="y" && isDoubled ? 4 : (match ==="o" ? 3 : 2)))), minSize =(match ==="y" ? size : 1), digits =new RegExp("^\\d{" + minSize + "," + size + "}"), num =value.substring(iValue).match(digits);if (!num){throw "Missing number at position " + iValue;}iValue +=num[0].length;return parseInt(num[0], 10);}, getName =function(match, shortNames, longNames){var index =-1, names =$.map(lookAhead(match)? longNames : shortNames, function (v, k){return [ [k, v] ];}).sort(function (a, b){return -(a[1].length - b[1].length);});$.each(names, function (i, pair){var name =pair[1];if (value.substr(iValue, name.length).toLowerCase()===name.toLowerCase()){index =pair[0];iValue +=name.length;return false;}});if (index !==-1){return index + 1;}else {throw "Unknown name at position " + iValue;}}, checkLiteral =function(){if (value.charAt(iValue)!==format.charAt(iFormat)){throw "Unexpected literal at position " + iValue;}iValue++;};for (iFormat =0;iFormat <format.length;iFormat++){if (literal){if (format.charAt(iFormat)==="'" && !lookAhead("'")){literal =false;}else {checkLiteral();}}else {switch (format.charAt(iFormat)){case "d": day =getNumber("d");break;case "D": getName("D", dayNamesShort, dayNames);break;case "o": doy =getNumber("o");break;case "m": month =getNumber("m");break;case "M": month =getName("M", monthNamesShort, monthNames);break;case "y": year =getNumber("y");break;case "@": date =new Date(getNumber("@"));year =date.getFullYear();month =date.getMonth()+ 1;day =date.getDate();break;case "!": date =new Date((getNumber("!")- this._ticksTo1970)/ 10000);year =date.getFullYear();month =date.getMonth()+ 1;day =date.getDate();break;case "'": if (lookAhead("'")){checkLiteral();}else {literal =true;}break;default: checkLiteral();}}}if (iValue <value.length){extra =value.substr(iValue);if (!/^\s+/.test(extra)){throw "Extra/unparsed characters found in date: " + extra;}}if (year ===-1){year =new Date().getFullYear();}else if (year <100){year +=new Date().getFullYear()- new Date().getFullYear()% 100 + (year <=shortYearCutoff ? 0 : -100);}if (doy >-1){month =1;day =doy;do {dim =this._getDaysInMonth(year, month - 1);if (day <=dim){break;}month++;day -=dim;}while (true);}date =this._daylightSavingAdjust(new Date(year, month - 1, day));if (date.getFullYear()!==year || date.getMonth()+ 1 !==month || date.getDate()!==day){throw "Invalid date";}return date;}, ATOM: "yy-mm-dd", COOKIE: "D, dd M yy", ISO_8601: "yy-mm-dd", RFC_822: "D, d M y", RFC_850: "DD, dd-M-y", RFC_1036: "D, d M y", RFC_1123: "D, d M yy", RFC_2822: "D, d M yy", RSS: "D, d M y", TICKS: "!", TIMESTAMP: "@", W3C: "yy-mm-dd", _ticksTo1970: (((1970 - 1)* 365 + Math.floor(1970 / 4)- Math.floor(1970 / 100)+ Math.floor(1970 / 400))* 24 * 60 * 60 * 10000000), formatDate: function (format, date, settings){if (!date){return "";}var iFormat, dayNamesShort =(settings ? settings.dayNamesShort : null)|| this._defaults.dayNamesShort, dayNames =(settings ? settings.dayNames : null)|| this._defaults.dayNames, monthNamesShort =(settings ? settings.monthNamesShort : null)|| this._defaults.monthNamesShort, monthNames =(settings ? settings.monthNames : null)|| this._defaults.monthNames, lookAhead =function(match){var matches =(iFormat + 1 <format.length && format.charAt(iFormat + 1)===match);if (matches){iFormat++;}return matches;}, formatNumber =function(match, value, len){var num ="" + value;if (lookAhead(match)){while (num.length <len){num ="0" + num;}}return num;}, formatName =function(match, value, shortNames, longNames){return (lookAhead(match)? longNames[value] : shortNames[value]);}, output ="", literal =false;if (date){for (iFormat =0;iFormat <format.length;iFormat++){if (literal){if (format.charAt(iFormat)==="'" && !lookAhead("'")){literal =false;}else {output +=format.charAt(iFormat);}}else {switch (format.charAt(iFormat)){case "d": output +=formatNumber("d", date.getDate(), 2);break;case "D": output +=formatName("D", date.getDay(), dayNamesShort, dayNames);break;case "o": output +=formatNumber("o", Math.round((new Date(date.getFullYear(), date.getMonth(), date.getDate()).getTime()- new Date(date.getFullYear(), 0, 0).getTime())/ 86400000), 3);break;case "m": output +=formatNumber("m", date.getMonth()+ 1, 2);break;case "M": output +=formatName("M", date.getMonth(), monthNamesShort, monthNames);break;case "y": output +=(lookAhead("y")? date.getFullYear(): (date.getYear()% 100 <10 ? "0" : "")+ date.getYear()% 100);break;case "@": output +=date.getTime();break;case "!": output +=date.getTime()* 10000 + this._ticksTo1970;break;case "'": if (lookAhead("'")){output +="'";}else {literal =true;}break;default: output +=format.charAt(iFormat);}}}}return output;}, _possibleChars: function (format){var iFormat, chars ="", literal =false, lookAhead =function(match){var matches =(iFormat + 1 <format.length && format.charAt(iFormat + 1)===match);if (matches){iFormat++;}return matches;};for (iFormat =0;iFormat <format.length;iFormat++){if (literal){if (format.charAt(iFormat)==="'" && !lookAhead("'")){literal =false;}else {chars +=format.charAt(iFormat);}}else {switch (format.charAt(iFormat)){case "d": case "m": case "y": case "@": chars +="0123456789";break;case "D": case "M": return null;case "'": if (lookAhead("'")){chars +="'";}else {literal =true;}break;default: chars +=format.charAt(iFormat);}}}return chars;}, _get: function(inst, name){return inst.settings[name] !==undefined ? inst.settings[name] : this._defaults[name];}, _setDateFromField: function(inst, noDefault){if (inst.input.val()===inst.lastVal){return;}var dateFormat =this._get(inst, "dateFormat"), dates =inst.lastVal =inst.input ? inst.input.val(): null, defaultDate =this._getDefaultDate(inst), date =defaultDate, settings =this._getFormatConfig(inst);try {date =this.parseDate(dateFormat, dates, settings)|| defaultDate;}catch (event){dates =(noDefault ? "" : dates);}inst.selectedDay =date.getDate();inst.drawMonth =inst.selectedMonth =date.getMonth();inst.drawYear =inst.selectedYear =date.getFullYear();inst.currentDay =(dates ? date.getDate(): 0);inst.currentMonth =(dates ? date.getMonth(): 0);inst.currentYear =(dates ? date.getFullYear(): 0);this._adjustInstDate(inst);}, _getDefaultDate: function(inst){return this._restrictMinMax(inst, this._determineDate(inst, this._get(inst, "defaultDate"), new Date()));}, _determineDate: function(inst, date, defaultDate){var offsetNumeric =function(offset){var date =new Date();date.setDate(date.getDate()+ offset);return date;}, offsetString =function(offset){try {return $.datepicker.parseDate($.datepicker._get(inst, "dateFormat"), offset, $.datepicker._getFormatConfig(inst));}catch (e){}var date =(offset.toLowerCase().match(/^c/)? $.datepicker._getDate(inst): null)|| new Date(), year =date.getFullYear(), month =date.getMonth(), day =date.getDate(), pattern =/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g, matches =pattern.exec(offset);while (matches){switch (matches[2] || "d"){case "d" : case "D" : day +=parseInt(matches[1],10);break;case "w" : case "W" : day +=parseInt(matches[1],10)* 7;break;case "m" : case "M" : month +=parseInt(matches[1],10);day =Math.min(day, $.datepicker._getDaysInMonth(year, month));break;case "y": case "Y" : year +=parseInt(matches[1],10);day =Math.min(day, $.datepicker._getDaysInMonth(year, month));break;}matches =pattern.exec(offset);}return new Date(year, month, day);}, newDate =(date ==null || date ==="" ? defaultDate : (typeof date ==="string" ? offsetString(date): (typeof date ==="number" ? (isNaN(date)? defaultDate : offsetNumeric(date)): new Date(date.getTime()))));newDate =(newDate && newDate.toString()==="Invalid Date" ? defaultDate : newDate);if (newDate){newDate.setHours(0);newDate.setMinutes(0);newDate.setSeconds(0);newDate.setMilliseconds(0);}return this._daylightSavingAdjust(newDate);}, _daylightSavingAdjust: function(date){if (!date){return null;}date.setHours(date.getHours()>12 ? date.getHours()+ 2 : 0);return date;}, _setDate: function(inst, date, noChange){var clear =!date, origMonth =inst.selectedMonth, origYear =inst.selectedYear, newDate =this._restrictMinMax(inst, this._determineDate(inst, date, new Date()));inst.selectedDay =inst.currentDay =newDate.getDate();inst.drawMonth =inst.selectedMonth =inst.currentMonth =newDate.getMonth();inst.drawYear =inst.selectedYear =inst.currentYear =newDate.getFullYear();if ((origMonth !==inst.selectedMonth || origYear !==inst.selectedYear)&& !noChange){this._notifyChange(inst);}this._adjustInstDate(inst);if (inst.input){inst.input.val(clear ? "" : this._formatDate(inst));}}, _getDate: function(inst){var startDate =(!inst.currentYear || (inst.input && inst.input.val()==="")? null : this._daylightSavingAdjust(new Date(inst.currentYear, inst.currentMonth, inst.currentDay)));return startDate;}, _attachHandlers: function(inst){var stepMonths =this._get(inst, "stepMonths"), id ="#" + inst.id.replace(/\\\\/g, "\\" );inst.dpDiv.find("[data-handler]").map(function (){var handler ={prev: function (){$.datepicker._adjustDate(id, -stepMonths, "M");}, next: function (){$.datepicker._adjustDate(id, +stepMonths, "M");}, hide: function (){$.datepicker._hideDatepicker();}, today: function (){$.datepicker._gotoToday(id);}, selectDay: function (){$.datepicker._selectDay(id, +this.getAttribute("data-month"), +this.getAttribute("data-year"), this);return false;}, selectMonth: function (){$.datepicker._selectMonthYear(id, this, "M");return false;}, selectYear: function (){$.datepicker._selectMonthYear(id, this, "Y");return false;}};$(this).bind(this.getAttribute("data-event"), handler[this.getAttribute("data-handler")]);});}, _generateHTML: function(inst){var maxDraw, prevText, prev, nextText, next, currentText, gotoDate, controls, buttonPanel, firstDay, showWeek, dayNames, dayNamesMin, monthNames, monthNamesShort, beforeShowDay, showOtherMonths, selectOtherMonths, defaultDate, html, dow, row, group, col, selectedDate, cornerClass, calender, thead, day, daysInMonth, leadDays, curRows, numRows, printDate, dRow, tbody, daySettings, otherMonth, unselectable, tempDate =new Date(), today =this._daylightSavingAdjust(new Date(tempDate.getFullYear(), tempDate.getMonth(), tempDate.getDate())), isRTL =this._get(inst, "isRTL"), showButtonPanel =this._get(inst, "showButtonPanel"), hideIfNoPrevNext =this._get(inst, "hideIfNoPrevNext"), navigationAsDateFormat =this._get(inst, "navigationAsDateFormat"), numMonths =this._getNumberOfMonths(inst), showCurrentAtPos =this._get(inst, "showCurrentAtPos"), stepMonths =this._get(inst, "stepMonths"), isMultiMonth =(numMonths[0] !==1 || numMonths[1] !==1), currentDate =this._daylightSavingAdjust((!inst.currentDay ? new Date(9999, 9, 9): new Date(inst.currentYear, inst.currentMonth, inst.currentDay))), minDate =this._getMinMaxDate(inst, "min"), maxDate =this._getMinMaxDate(inst, "max"), drawMonth =inst.drawMonth - showCurrentAtPos, drawYear =inst.drawYear;if (drawMonth <0){drawMonth +=12;drawYear--;}if (maxDate){maxDraw =this._daylightSavingAdjust(new Date(maxDate.getFullYear(), maxDate.getMonth()- (numMonths[0] * numMonths[1])+ 1, maxDate.getDate()));maxDraw =(minDate && maxDraw <minDate ? minDate : maxDraw);while (this._daylightSavingAdjust(new Date(drawYear, drawMonth, 1))>maxDraw){drawMonth--;if (drawMonth <0){drawMonth =11;drawYear--;}}}inst.drawMonth =drawMonth;inst.drawYear =drawYear;prevText =this._get(inst, "prevText");prevText =(!navigationAsDateFormat ? prevText : this.formatDate(prevText, this._daylightSavingAdjust(new Date(drawYear, drawMonth - stepMonths, 1)), this._getFormatConfig(inst)));prev =(this._canAdjustMonth(inst, -1, drawYear, drawMonth)? "<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click'" + " title='" + prevText + "'><span class='ui-icon ui-icon-circle-triangle-" + (isRTL ? "e" : "w")+ "'>" + prevText + "</span></a>" : (hideIfNoPrevNext ? "" : "<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+ prevText +"'><span class='ui-icon ui-icon-circle-triangle-" + (isRTL ? "e" : "w")+ "'>" + prevText + "</span></a>"));nextText =this._get(inst, "nextText");nextText =(!navigationAsDateFormat ? nextText : this.formatDate(nextText, this._daylightSavingAdjust(new Date(drawYear, drawMonth + stepMonths, 1)), this._getFormatConfig(inst)));next =(this._canAdjustMonth(inst, +1, drawYear, drawMonth)? "<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click'" + " title='" + nextText + "'><span class='ui-icon ui-icon-circle-triangle-" + (isRTL ? "w" : "e")+ "'>" + nextText + "</span></a>" : (hideIfNoPrevNext ? "" : "<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+ nextText + "'><span class='ui-icon ui-icon-circle-triangle-" + (isRTL ? "w" : "e")+ "'>" + nextText + "</span></a>"));currentText =this._get(inst, "currentText");gotoDate =(this._get(inst, "gotoCurrent")&& inst.currentDay ? currentDate : today);currentText =(!navigationAsDateFormat ? currentText : this.formatDate(currentText, gotoDate, this._getFormatConfig(inst)));controls =(!inst.inline ? "<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>" + this._get(inst, "closeText")+ "</button>" : "");buttonPanel =(showButtonPanel)? "<div class='ui-datepicker-buttonpane ui-widget-content'>" + (isRTL ? controls : "")+ (this._isInRange(inst, gotoDate)? "<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'" + ">" + currentText + "</button>" : "")+ (isRTL ? "" : controls)+ "</div>" : "";firstDay =parseInt(this._get(inst, "firstDay"),10);firstDay =(isNaN(firstDay)? 0 : firstDay);showWeek =this._get(inst, "showWeek");dayNames =this._get(inst, "dayNames");dayNamesMin =this._get(inst, "dayNamesMin");monthNames =this._get(inst, "monthNames");monthNamesShort =this._get(inst, "monthNamesShort");beforeShowDay =this._get(inst, "beforeShowDay");showOtherMonths =this._get(inst, "showOtherMonths");selectOtherMonths =this._get(inst, "selectOtherMonths");defaultDate =this._getDefaultDate(inst);html ="";dow;for (row =0;row <numMonths[0];row++){group ="";this.maxRows =4;for (col =0;col <numMonths[1];col++){selectedDate =this._daylightSavingAdjust(new Date(drawYear, drawMonth, inst.selectedDay));cornerClass =" ui-corner-all";calender ="";if (isMultiMonth){calender +="<div class='ui-datepicker-group";if (numMonths[1] >1){switch (col){case 0: calender +=" ui-datepicker-group-first";cornerClass =" ui-corner-" + (isRTL ? "right" : "left");break;case numMonths[1]-1: calender +=" ui-datepicker-group-last";cornerClass =" ui-corner-" + (isRTL ? "left" : "right");break;default: calender +=" ui-datepicker-group-middle";cornerClass ="";break;}}calender +="'>";}calender +="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix" + cornerClass + "'>" + (/all|left/.test(cornerClass)&& row ===0 ? (isRTL ? next : prev): "")+ (/all|right/.test(cornerClass)&& row ===0 ? (isRTL ? prev : next): "")+ this._generateMonthYearHeader(inst, drawMonth, drawYear, minDate, maxDate, row >0 || col >0, monthNames, monthNamesShort)+ "</div><table class='ui-datepicker-calendar'><thead>" + "<tr>";thead =(showWeek ? "<th class='ui-datepicker-week-col'>" + this._get(inst, "weekHeader")+ "</th>" : "");for (dow =0;dow <7;dow++){day =(dow + firstDay)% 7;thead +="<th scope='col'" + ((dow + firstDay + 6)% 7 >=5 ? " class='ui-datepicker-week-end'" : "")+ ">" + "<span title='" + dayNames[day] + "'>" + dayNamesMin[day] + "</span></th>";}calender +=thead + "</tr></thead><tbody>";daysInMonth =this._getDaysInMonth(drawYear, drawMonth);if (drawYear ===inst.selectedYear && drawMonth ===inst.selectedMonth){inst.selectedDay =Math.min(inst.selectedDay, daysInMonth);}leadDays =(this._getFirstDayOfMonth(drawYear, drawMonth)- firstDay + 7)% 7;curRows =Math.ceil((leadDays + daysInMonth)/ 7);numRows =(isMultiMonth ? this.maxRows >curRows ? this.maxRows : curRows : curRows);this.maxRows =numRows;printDate =this._daylightSavingAdjust(new Date(drawYear, drawMonth, 1 - leadDays));for (dRow =0;dRow <numRows;dRow++){calender +="<tr>";tbody =(!showWeek ? "" : "<td class='ui-datepicker-week-col'>" + this._get(inst, "calculateWeek")(printDate)+ "</td>");for (dow =0;dow <7;dow++){daySettings =(beforeShowDay ? beforeShowDay.apply((inst.input ? inst.input[0] : null), [printDate]): [true, ""]);otherMonth =(printDate.getMonth()!==drawMonth);unselectable =(otherMonth && !selectOtherMonths)|| !daySettings[0] || (minDate && printDate <minDate)|| (maxDate && printDate >maxDate);tbody +="<td class='" + ((dow + firstDay + 6)% 7 >=5 ? " ui-datepicker-week-end" : "")+ (otherMonth ? " ui-datepicker-other-month" : "")+ ((printDate.getTime()===selectedDate.getTime()&& drawMonth ===inst.selectedMonth && inst._keyEvent)|| (defaultDate.getTime()===printDate.getTime()&& defaultDate.getTime()===selectedDate.getTime())? " " + this._dayOverClass : "")+ (unselectable ? " " + this._unselectableClass + " ui-state-disabled": "")+ (otherMonth && !showOtherMonths ? "" : " " + daySettings[1] + (printDate.getTime()===currentDate.getTime()? " " + this._currentClass : "")+ (printDate.getTime()===today.getTime()? " ui-datepicker-today" : ""))+ "'" + ((!otherMonth || showOtherMonths)&& daySettings[2] ? " title='" + daySettings[2].replace(/'/g, "&#39;")+ "'" : "")+ (unselectable ? "" : " data-handler='selectDay' data-event='click' data-month='" + printDate.getMonth()+ "' data-year='" + printDate.getFullYear()+ "'")+ ">" + (otherMonth && !showOtherMonths ? "&#xa0;" : (unselectable ? "<span class='ui-state-default'>" + printDate.getDate()+ "</span>" : "<a class='ui-state-default" + (printDate.getTime()===today.getTime()? " ui-state-highlight" : "")+ (printDate.getTime()===currentDate.getTime()? " ui-state-active" : "")+ (otherMonth ? " ui-priority-secondary" : "")+ "' href='#'>" + printDate.getDate()+ "</a>"))+ "</td>";printDate.setDate(printDate.getDate()+ 1);printDate =this._daylightSavingAdjust(printDate);}calender +=tbody + "</tr>";}drawMonth++;if (drawMonth >11){drawMonth =0;drawYear++;}calender +="</tbody></table>" + (isMultiMonth ? "</div>" + ((numMonths[0] >0 && col ===numMonths[1]-1)? "<div class='ui-datepicker-row-break'></div>" : ""): "");group +=calender;}html +=group;}html +=buttonPanel;inst._keyEvent =false;return html;}, _generateMonthYearHeader: function(inst, drawMonth, drawYear, minDate, maxDate, secondary, monthNames, monthNamesShort){var inMinYear, inMaxYear, month, years, thisYear, determineYear, year, endYear, changeMonth =this._get(inst, "changeMonth"), changeYear =this._get(inst, "changeYear"), showMonthAfterYear =this._get(inst, "showMonthAfterYear"), html ="<div class='ui-datepicker-title'>", monthHtml ="";if (secondary || !changeMonth){monthHtml +="<span class='ui-datepicker-month'>" + monthNames[drawMonth] + "</span>";}else {inMinYear =(minDate && minDate.getFullYear()===drawYear);inMaxYear =(maxDate && maxDate.getFullYear()===drawYear);monthHtml +="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>";for (month =0;month <12;month++){if ((!inMinYear || month >=minDate.getMonth())&& (!inMaxYear || month <=maxDate.getMonth())){monthHtml +="<option value='" + month + "'" + (month ===drawMonth ? " selected='selected'" : "")+ ">" + monthNamesShort[month] + "</option>";}}monthHtml +="</select>";}if (!showMonthAfterYear){html +=monthHtml + (secondary || !(changeMonth && changeYear)? "&#xa0;" : "");}if (!inst.yearshtml ){inst.yearshtml ="";if (secondary || !changeYear){html +="<span class='ui-datepicker-year'>" + drawYear + "</span>";}else {years =this._get(inst, "yearRange").split(":");thisYear =new Date().getFullYear();determineYear =function(value){var year =(value.match(/c[+\-].*/)? drawYear + parseInt(value.substring(1), 10): (value.match(/[+\-].*/)? thisYear + parseInt(value, 10): parseInt(value, 10)));return (isNaN(year)? thisYear : year);};year =determineYear(years[0]);endYear =Math.max(year, determineYear(years[1] || ""));year =(minDate ? Math.max(year, minDate.getFullYear()): year);endYear =(maxDate ? Math.min(endYear, maxDate.getFullYear()): endYear);inst.yearshtml +="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";for (;year <=endYear;year++){inst.yearshtml +="<option value='" + year + "'" + (year ===drawYear ? " selected='selected'" : "")+ ">" + year + "</option>";}inst.yearshtml +="</select>";html +=inst.yearshtml;inst.yearshtml =null;}}html +=this._get(inst, "yearSuffix");if (showMonthAfterYear){html +=(secondary || !(changeMonth && changeYear)? "&#xa0;" : "")+ monthHtml;}html +="</div>";return html;}, _adjustInstDate: function(inst, offset, period){var year =inst.drawYear + (period ==="Y" ? offset : 0), month =inst.drawMonth + (period ==="M" ? offset : 0), day =Math.min(inst.selectedDay, this._getDaysInMonth(year, month))+ (period ==="D" ? offset : 0), date =this._restrictMinMax(inst, this._daylightSavingAdjust(new Date(year, month, day)));inst.selectedDay =date.getDate();inst.drawMonth =inst.selectedMonth =date.getMonth();inst.drawYear =inst.selectedYear =date.getFullYear();if (period ==="M" || period ==="Y"){this._notifyChange(inst);}}, _restrictMinMax: function(inst, date){var minDate =this._getMinMaxDate(inst, "min"), maxDate =this._getMinMaxDate(inst, "max"), newDate =(minDate && date <minDate ? minDate : date);return (maxDate && newDate >maxDate ? maxDate : newDate);}, _notifyChange: function(inst){var onChange =this._get(inst, "onChangeMonthYear");if (onChange){onChange.apply((inst.input ? inst.input[0] : null), [inst.selectedYear, inst.selectedMonth + 1, inst]);}}, _getNumberOfMonths: function(inst){var numMonths =this._get(inst, "numberOfMonths");return (numMonths ==null ? [1, 1] : (typeof numMonths ==="number" ? [1, numMonths] : numMonths));}, _getMinMaxDate: function(inst, minMax){return this._determineDate(inst, this._get(inst, minMax + "Date"), null);}, _getDaysInMonth: function(year, month){return 32 - this._daylightSavingAdjust(new Date(year, month, 32)).getDate();}, _getFirstDayOfMonth: function(year, month){return new Date(year, month, 1).getDay();}, _canAdjustMonth: function(inst, offset, curYear, curMonth){var numMonths =this._getNumberOfMonths(inst), date =this._daylightSavingAdjust(new Date(curYear, curMonth + (offset <0 ? offset : numMonths[0] * numMonths[1]), 1));if (offset <0){date.setDate(this._getDaysInMonth(date.getFullYear(), date.getMonth()));}return this._isInRange(inst, date);}, _isInRange: function(inst, date){var yearSplit, currentYear, minDate =this._getMinMaxDate(inst, "min"), maxDate =this._getMinMaxDate(inst, "max"), minYear =null, maxYear =null, years =this._get(inst, "yearRange");if (years){yearSplit =years.split(":");currentYear =new Date().getFullYear();minYear =parseInt(yearSplit[0], 10);maxYear =parseInt(yearSplit[1], 10);if (yearSplit[0].match(/[+\-].*/)){minYear +=currentYear;}if (yearSplit[1].match(/[+\-].*/)){maxYear +=currentYear;}}return ((!minDate || date.getTime()>=minDate.getTime())&& (!maxDate || date.getTime()<=maxDate.getTime())&& (!minYear || date.getFullYear()>=minYear)&& (!maxYear || date.getFullYear()<=maxYear));}, _getFormatConfig: function(inst){var shortYearCutoff =this._get(inst, "shortYearCutoff");shortYearCutoff =(typeof shortYearCutoff !=="string" ? shortYearCutoff : new Date().getFullYear()% 100 + parseInt(shortYearCutoff, 10));return {shortYearCutoff: shortYearCutoff, dayNamesShort: this._get(inst, "dayNamesShort"), dayNames: this._get(inst, "dayNames"), monthNamesShort: this._get(inst, "monthNamesShort"), monthNames: this._get(inst, "monthNames")};}, _formatDate: function(inst, day, month, year){if (!day){inst.currentDay =inst.selectedDay;inst.currentMonth =inst.selectedMonth;inst.currentYear =inst.selectedYear;}var date =(day ? (typeof day ==="object" ? day : this._daylightSavingAdjust(new Date(year, month, day))): this._daylightSavingAdjust(new Date(inst.currentYear, inst.currentMonth, inst.currentDay)));return this.formatDate(this._get(inst, "dateFormat"), date, this._getFormatConfig(inst));}});function datepicker_bindHover(dpDiv){var selector ="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return dpDiv.delegate(selector, "mouseout", function(){$(this).removeClass("ui-state-hover");if (this.className.indexOf("ui-datepicker-prev")!==-1){$(this).removeClass("ui-datepicker-prev-hover");}if (this.className.indexOf("ui-datepicker-next")!==-1){$(this).removeClass("ui-datepicker-next-hover");}}).delegate(selector, "mouseover", datepicker_handleMouseover );}function datepicker_handleMouseover(){if (!$.datepicker._isDisabledDatepicker(datepicker_instActive.inline? datepicker_instActive.dpDiv.parent()[0] : datepicker_instActive.input[0])){$(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover");$(this).addClass("ui-state-hover");if (this.className.indexOf("ui-datepicker-prev")!==-1){$(this).addClass("ui-datepicker-prev-hover");}if (this.className.indexOf("ui-datepicker-next")!==-1){$(this).addClass("ui-datepicker-next-hover");}}}function datepicker_extendRemove(target, props){$.extend(target, props);for (var name in props){if (props[name] ==null){target[name] =props[name];}}return target;}$.fn.datepicker =function(options){if (!this.length ){return this;}if (!$.datepicker.initialized){$(document).mousedown($.datepicker._checkExternalClick);$.datepicker.initialized =true;}if ($("#"+$.datepicker._mainDivId).length ===0){$("body").append($.datepicker.dpDiv);}var otherArgs =Array.prototype.slice.call(arguments, 1);if (typeof options ==="string" && (options ==="isDisabled" || options ==="getDate" || options ==="widget")){return $.datepicker["_" + options + "Datepicker"]. apply($.datepicker, [this[0]].concat(otherArgs));}if (options ==="option" && arguments.length ===2 && typeof arguments[1] ==="string"){return $.datepicker["_" + options + "Datepicker"]. apply($.datepicker, [this[0]].concat(otherArgs));}return this.each(function(){typeof options ==="string" ? $.datepicker["_" + options + "Datepicker"]. apply($.datepicker, [this].concat(otherArgs)): $.datepicker._attachDatepicker(this, options);});};$.datepicker =new Datepicker();$.datepicker.initialized =false;$.datepicker.uuid =new Date().getTime();$.datepicker.version ="1.11.4";var datepicker =$.datepicker;}));MWT.SelectField=function(opt){this.listeners={};this.options=[];if(opt){if(isset(opt.options))this.options=opt.options;this.construct(opt);if(this.id=="")this.id=this.render+"sel";}this.create=function(){var thiso=this;var domid=this.id;var code="<select id='"+this.id+"'";if(this.cls!=""){code+=" class='"+this.cls+"'";}else{code+=" class='form-control'";}if(this.style!="")code+=" style=\""+this.style+"\"";else code+=" style=\"width:auto;border-radius:2px;\"";code+=">";for(var i=0;i<this.options.length;++i){var v=isset(this.value)?this.value:0;var selected=this.options[i].value==v?"selected":"";code +="<option value='"+this.options[i].value+"' "+selected+">"+this.options[i].text+"</option>";}code+="</select>";$("#"+this.render).html(code);$("#"+domid).change(function(){var v=$(this).children('option:selected').val();thiso.value=v;thiso.fire("change");});};this.setValue=function(v){this.value=v;set_select_value(this.id,v);};};MWT.extends(MWT.SelectField, MWT.Field);Date.prototype.format =function(fmt){var o ={"m+" : this.getMonth()+1, "d+" : this.getDate(), "h+" : this.getHours(), "M+" : this.getMinutes(), "s+" : this.getSeconds(), "q+" : Math.floor((this.getMonth()+3)/3), "S" : this.getMilliseconds()};if(/(y+)/.test(fmt))fmt=fmt.replace(RegExp.$1, (this.getFullYear()+"").substr(2 - RegExp.$1.length));for(var k in o)if(new RegExp("("+ k +")").test(fmt))fmt =fmt.replace(RegExp.$1, (RegExp.$1.length==1)? (o[k]): (("00"+ o[k]).substr((""+ o[k]).length)));return fmt;};MWT.DatePicker=function(opt){this.listeners={};this.format="yy/mm/dd";if (opt){this.construct(opt);if(this.id=="")this.id=this.render+"txt";if(isset(opt.format))this.format=opt.format;if(!isset(opt.value))this.value=new Date().format(this.format);}this.create=function(){var thiso=this;var txtid=this.id;var code="<input type='text' class='form-control form-datepicker'";if(this.style!="")code+=" style=\""+this.style+"\"";code+=" id='"+txtid+"' value='"+this.value+"' readonly/>";$("#"+this.render).html(code);$("#"+txtid).datepicker({changeMonth:true, numberOfMonths:1, dateFormat: this.format });$("#"+txtid).change(function(){thiso.value=$(this).val();thiso.fire("change");});};this.setValue=function(v){this.value=v;set_value(this.id,v);};};MWT.extends(MWT.DatePicker, MWT.Field);MWT.DateRangePicker=function(opt){this.listeners={};this.format="yy/mm/dd";this.float="left";if (opt){this.construct(opt);if(isset(opt.format))this.format=opt.format;if(isset(opt.float))this.float=opt.float;if(this.id=="")this.id=this.render+"txt";}this.create=function(){var thiso=this;var txtid=this.id;var rangeid=this.id+"rdiv";var fromid=this.id+"from";var toid=this.id+"to";var style=" style=\"width:180px\" ";if(this.style!="")style=" style=\""+this.style+"\" ";var code="<div class='date-range'><input type='text' class='form-control form-datepicker'"+style+ "id='"+txtid+"' value='"+this.value+"' readonly/>"+ "<div class='date-pop' id='"+rangeid+"' style='"+this.float+":0;'>"+ "<div class='btn-bar'>"+ '<button class="date-submit mwt-btn mwt-btn-default mwt-btn-sm" data-value="90">最近90天</button>'+ '<button class="date-submit mwt-btn mwt-btn-default mwt-btn-sm" data-value="60">最近60天</button>'+ '<button class="date-submit mwt-btn mwt-btn-default mwt-btn-sm" data-value="30">最近30天</button>'+ '<button class="date-submit mwt-btn mwt-btn-default mwt-btn-sm" data-value="7">最近7天</button>'+ '<button class="date-submit mwt-btn mwt-btn-danger mwt-btn-sm fr" data-value="cancel">取消</button>'+ '<button class="date-submit mwt-btn mwt-btn-primary mwt-btn-sm fr">确定</button>'+ "</div>"+ '<div class="date-area" id="'+fromid+'"></div>'+ '<div class="date-area" id="'+toid+'" style="float:right;"></div>'+ "</div></div>";$("#"+this.render).html(code);var txtdom=$("#"+txtid);txtdom.click(function(){$("#"+rangeid).show('fast');});var fromdom=$("#"+fromid);var todom=$("#"+toid);fromdom.datepicker({defaultDate: "+1w", changeMonth: true, numberOfMonths: 1, onSelect : function(selectedDate ){todom.datepicker("option", "minDate", selectedDate );}});todom.datepicker({defaultDate: "+1w", changeMonth: true, numberOfMonths: 1, onSelect : function(selectedDate ){fromdom.datepicker("option", "maxDate", selectedDate );}});var obj=$('#'+rangeid);obj.find('.date-submit').click(function(){var btn =$(this);if(btn.data('value')){var v=btn.data('value');if(v=="cancel"){$("#"+rangeid).hide('fast');return;}var fromdate=new Date();var todate=new Date();fromdate.setTime(fromdate.getTime()-86400000*v);todate.setTime(todate.getTime()-86400000);fromdom.datepicker('setDate',fromdate);todom.datepicker('setDate',todate);}var fv=fromdom.datepicker('getDate').format(thiso.format);var tv=todom.datepicker('getDate').format(thiso.format);thiso.value=fv+" ~ "+tv;txtdom.val(thiso.value);$("#"+rangeid).hide('fast');thiso.fire("change");});this.setDefault(7);};this.setDefault=function(v){var thiso=this;var fromid=this.id+"from";var toid=this.id+"to";var txtid=this.id;var fromdom=$("#"+fromid);var todom=$("#"+toid);var txtdom=$("#"+txtid);var fromdate=new Date();var todate=new Date();fromdate.setTime(fromdate.getTime()-86400000*v);todate.setTime(todate.getTime()-86400000);fromdom.datepicker('setDate',fromdate);todom.datepicker('setDate',todate);var fv=fromdom.datepicker('getDate').format(thiso.format);var tv=todom.datepicker('getDate').format(thiso.format);thiso.value=fv+" ~ "+tv;txtdom.val(thiso.value);};};MWT.extends(MWT.DateRangePicker, MWT.Field);MWT.RadiobtnField=function(opt){this.listeners={};this.options=[];if(opt){if(isset(opt.options))this.options=opt.options;this.construct(opt);if(this.id=="")this.id=this.render+"sel";if(opt.style)this.style=opt.style;if(opt.class)this.class=opt.class;}this.create=function(){var thiso=this;var domid=this.id+"rabtn";var code="<div class='mwt-btn-group' style='"+this.style+"'>";for(var i=0;i<this.options.length;++i){var v=isset(this.value)?this.value:0;var selected=this.options[i].value==v?"active":"";var cls ="mwt-btn mwt-btn-xs";if(isset(this.class))cls+=" "+this.class;else cls+=" mwt-btn-primary";cls+=" "+selected;code+="<button name='"+domid+"' class='"+cls+"' data-value='"+this.options[i].value+"'>"+this.options[i].text+"</button>";}code+="</div><input type='hidden' id='"+this.id+"' value='"+this.value+"'/>";$("#"+this.render).html(code);$("button[name="+domid+"]").click(function(){$("button[name="+domid+"]").removeClass("active");$(this).addClass("active");thiso.value=$(this).data("value");set_value(thiso.id,thiso.value);thiso.fire("change");});};this.setValue=function(v){this.value=v;$("#"+this.id).val(v);var domid=this.id+"rabtn";$("button[name="+domid+"]").removeClass("active");$("button[data-value='"+v+"']").addClass("active");};};MWT.extends(MWT.RadiobtnField, MWT.Field);MWT.Toolbar=function(opt){this.listeners={};this.render=null;this.cls="";this.style="";this.items=[];if(opt){if(opt.render)this.render=opt.render;if(opt.items)this.items=opt.items;if(opt.cls)this.cls=opt.cls;if(opt.style)this.style=opt.style;}this.create=function(){var code="<div class='mwt-toolbar'>"+this.createItems()+"</div>";$("#"+this.render).html(code);};this.createItems=function(){var code="<div class='row'><ul>";var hr=false;for(var i=0;i<this.items.length;++i){var item=this.items[i];var type=typeof(item);if(type=="string"){switch(item){case '-':code+="</ul></div><hr><div class='row'><ul>";break;case '->':code+="</ul><ul class='right'>";break;case '|':code+="<li class='sep'></li>";break;default: code+="<li>"+item+"</li>";break;}}else{}}code+="</ul></div>";return code;};};MWT.extends(MWT.Toolbar, MWT.Event);MWT.Dialog =function(opt){this.listeners ={};var title ="新建窗口";var dom =null;var dialog_body_id ="";var dialog_title_id ="";var dialog_content_id ="";var render ="";var width ="500px";var height ="auto";var top =100;var buttons=null;var form;if (opt){if (opt.title)title =opt.title;if (opt.width)width =opt.width+"px";if (opt.height)height =opt.height+"px";if (opt.top)top =opt.top;if (opt.form)form=opt.form;if(opt.buttons)buttons=opt.buttons;render =opt.render;}function dig_mdown(e){if (e.which!=1)return;var obj=document.getElementById(dialog_body_id);obj.style.cursor ="move";$("#"+dialog_body_id).data("mdown","1");$("#"+dialog_body_id).data("objX", obj.style.left);$("#"+dialog_body_id).data("objY", obj.style.top);$("#"+dialog_body_id).data("mouseX", e.clientX);$("#"+dialog_body_id).data("mouseY",e.clientY);}function dig_mmove(e){if (e.which!=1)return;if ($("#"+dialog_body_id).data("mdown")==1){var objX =$("#"+dialog_body_id).data("objX");var objY =$("#"+dialog_body_id).data("objY");var mouseX =$("#"+dialog_body_id).data("mouseX");var mouseY =$("#"+dialog_body_id).data("mouseY");var obj=document.getElementById(dialog_body_id);var x =e.clientX;var y =e.clientY;obj.style.left =parseInt(objX)+ parseInt(x)- parseInt(mouseX)+ "px";obj.style.top =parseInt(objY)+ parseInt(y)- parseInt(mouseY)+ "px";}}function dig_mup(e){if (e.which!=1)return;var obj=document.getElementById(dialog_body_id);obj.style.cursor ="default";$("#"+dialog_body_id).data("mdown","0");}this.create =function(){var thiso=this;var eleid =render;dialog_body_id =eleid+"-dialog-body";dialog_title_id =eleid+"-dialog-title";dialog_content_id =eleid+"-dialog-content";dom =document.getElementById(eleid);dom.className ="mwt-dialog";var content_html =dom.innerHTML;if(isset(form))content_html="<div id='"+form.render+"' style='margin:5px;'></div>";var htmlcode ="<div class='modaldiv'></div>";htmlcode+="<div id='"+dialog_body_id+"' class='dialog-body'";htmlcode+="style='top:"+top+"px;left:0;padding:4px;'>";htmlcode+="<div style='height:30px;line-height:30px;' id='d-head-"+eleid+"'><table class='tablay'>"+ "<tr><td class='header' id='"+dialog_title_id+"'>"+title+"</td>"+ "<td style='align:right;'>"+ "<a class='btnclose' href='javascript:hide(\""+eleid+"\")'> × </a></td></t></table></div>";htmlcode+="<div class='content' onmousedown='' style='width:"+width+";height:"+height+"' id='"+dialog_content_id+"'>"+content_html+"</div>";if(buttons&&buttons.length>0){htmlcode+="<div id='d-foot-"+eleid+"' style='height:40px;line-height:40px;text-align:right'>";for(var i=0;i<buttons.length;i++){var cls=isset(buttons[i].cls)?buttons[i].cls:"mwt-btn-default";htmlcode+=" <button class='mwt-btn "+cls+" mwt-btn-sm' id='"+eleid+i+"btn'>"+buttons[i].label+"</button>";}htmlcode+="</div>";}htmlcode+="</div></div>";dom.innerHTML=htmlcode;if(isset(form)){form.create();}if(buttons&&buttons.length>0){for(var i=0;i<buttons.length;i++){var btnid=eleid+i+"btn";if (buttons[i].type=='close'){$("#"+btnid).click(function(){thiso.close();});}else if (buttons[i].type=='submit' && isset(form)){$("#"+btnid).click(function(){form.submit();});}else if(isset(buttons[i].handler)){$("#"+btnid).click(buttons[i].handler);}}}$("#d-head-"+eleid).mousedown(dig_mdown);$("#d-head-"+eleid).mousemove(dig_mmove);$("#d-head-"+eleid).mouseup(dig_mup);$("#d-foot-"+eleid).mousedown(dig_mdown);$("#d-foot-"+eleid).mousemove(dig_mmove);$("#d-foot-"+eleid).mouseup(dig_mup);};this.open =function(){if (dom ==null){this.create();}this.fire("beforeOpen");dom.style.display ="block";this.fire("open");};this.close =function(){dom.style.display ="none";};this.setTitle =function(text){title =text;if (dom){document.getElementById(dialog_title_id).innerHTML =title;}};};MWT.extends(MWT.Dialog, MWT.Event);MWT.Form =function(opt){this.listeners ={};this.item ={};this.render =null;var items =[];var formid ="";if (opt){if (opt.render){this.render=opt.render;formid=this.render+"-fm";}if (opt.items)items=opt.items;}function get_hidden_code(item){var value =item.value ? item.value : "";return "<input name='"+item.name+"' type='hidden' value='"+value+"'>";}function get_text_code(item){var style =item.style ? "style=\""+item.style+"\"" : "";var value =item.value ? item.value : "";return "<input name='"+item.name+"' type='text' class='form-control' "+style+" value='"+value+"'>";}function get_textarea_code(item){var style =item.style ? "style=\""+item.style+"\"" : "";var value =item.value ? item.value : "";return "<textarea name='"+item.name+"' class='form-control' "+style+">"+value+"</textarea>";}function get_text_value(item){var name =item.name;var formdom =document.getElementById(formid);var value =formdom[name].value.trim();formdom[name].value =value;if (value ==""){if (item.errmsg){document.getElementById(name+"-errmsg").innerHTML =item.errmsg;}formdom[name].focus();throw new Error(name+" is empty");}return value;}function reset_text_value(item){var value =item.value ? item.value : "";var formdom =document.getElementById(formid);formdom[item.name].value =value;}function set_text_value(item, record){if (record[item.name]){var formdom =document.getElementById(formid);formdom[item.name].value =record[item.name];}}function get_select_code(item){var style =item.style ? "style=\""+item.style+"\"" : "";var value =item.value ? item.value : "";var code ="<select name='"+item.name+"' class='form-control' "+style+">";for (var i=0;i<item.options.length;++i){var selected =item.options[i].value==item.value ? "selected" : "";code +="<option value='"+item.options[i].value+"' "+selected+">"+item.options[i].text+"</option>";}code +="</select>";return code;}function get_select_value(item){var formdom =document.getElementById(formid);var sel =formdom[item.name];return sel.options[sel.selectedIndex].value;}function reset_select_value(item){var formdom =document.getElementById(formid);var sel =formdom[item.name];var value =item.value;for(var i=0;i<sel.options.length;i=i+1){if(sel.options[i].value ==value){sel.options[i].selected =true;break;}}}function set_select_value(item, record){var formdom =document.getElementById(formid);var sel =formdom[item.name];var value =record[item.name];for(var i=0;i<sel.options.length;i=i+1){if(sel.options[i].value ==value){sel.options[i].selected =true;break;}}}function get_radio_code(item){var style =item.style ? "style=\""+item.style+"\"" : "";var value =item.value ? item.value : "";var code ="<div class='form-control'>";for (var i=0;i<item.options.length;++i){var checked =item.options[i].value==item.value ? "checked" : "";code +="<label class='pointer' "+style+"><input type='radio' name='"+item.name+"' "+ " value='"+item.options[i].value+"' "+checked+">"+item.options[i].text+"</label>";}code +="</div>";return code;}function get_radio_value(item){var formdom =document.getElementById(formid);var radios =formdom[item.name];for(var i=0;i<radios.length;i=i+1){if(radios[i].checked ==true){return radios[i].value;}}if (item.errmsg){document.getElementById(name+"-errmsg").innerHTML =item.errmsg;}throw new Error(item.name+" is not select");}function set_radio_value(item, record){var formdom =document.getElementById(formid);var radios =formdom[item.name];for (var i=0;i<radios.length;++i){if (radios[i].value ==record[item.name]){radios[i].checked =true;return;}}}function reset_radio_value(item){var record ={};record[item.name] =item.value;set_radio_value(item, record);}function get_checkbox_code(item){var style =item.style ? "style=\""+item.style+"\"" : "";var value =item.value ? item.value : "";var code ="<div class='form-control'>";for (var i=0;i<item.options.length;++i){var checked =item.options[i].value==item.value ? "checked" : "";code +="<label class='pointer' "+style+"><input type='checkbox' name='"+item.name+"' "+ " value='"+item.options[i].value+"' "+checked+">"+item.options[i].text+"</label>";}code +="</div>";return code;}function get_checkbox_value(item){var formdom =document.getElementById(formid);var values =get_checkbox_values(item.name);if (values.length>0){return values.join(",");}if (item.errmsg){document.getElementById(item.name+"-errmsg").innerHTML =item.errmsg;throw new Error(item.name+" is not select");}return "";}function set_checkbox_value(item, record){var formdom =document.getElementById(formid);var values =record[item.name].split(",");set_checkbox_values(item.name, values);}function reset_checkbox_value(item){var record ={};record[item.name] =item.value;set_checkbox_value(item, record);}this.create =function(){var eleid =this.render;var code="<form id='"+formid+"' onsubmit='return false;'>"+ "<table class='form'>";for (var i=0;i<items.length;++i){var label =items[i].label;var name =items[i].name;var type =items[i].type;if (type=="hidden"){code+=get_hidden_code(items[i]);continue;}code +="<tr><td class='form-label'>"+label+"</td>"+ "<td style='text-align:right'><div id='"+name+"-errmsg' class='errmsg'></div></td>"+ "<tr><td colspan='2'>";switch (type){case 'text': code+=get_text_code(items[i]);break;case 'textarea': code+=get_textarea_code(items[i]);break;case 'select': code+=get_select_code(items[i]);break;case 'radio': code+=get_radio_code(items[i]);break;case 'checkbox': code+=get_checkbox_code(items[i]);break;}code +="</td></tr>";}code +="</table></form>";document.getElementById(eleid).innerHTML =code;};this.submit =function(){var thiso=this;this.item ={};var formdom =document.getElementById(formid);for (var i=0;i<items.length;++i){var name =items[i].name;var type =items[i].type;var dom =document.getElementById(items[i].name+"-errmsg");if(dom)dom.innerHTML ="";switch (type){case 'hidden': case 'text': case 'textarea': this.item[name] =get_text_value(items[i]);break;case 'select': this.item[name] =get_select_value(items[i]);break;case 'radio': this.item[name] =get_radio_value(items[i]);break;case 'checkbox': this.item[name] =get_checkbox_value(items[i]);break;}};thiso.fire("submit");};this.load =function(record){var formdom =document.getElementById(formid);for (var i=0;i<items.length;++i){var dom =document.getElementById(items[i].name+"-errmsg");if(dom)dom.innerHTML ="";switch (items[i].type){case "hidden": case "text": case "textarea": set_text_value(items[i], record);break;case "select": set_select_value(items[i], record);break;case "radio": set_radio_value(items[i], record);break;case "checkbox": set_checkbox_value(items[i], record);break;}}this.fire("load");};this.reset =function(){var formdom =document.getElementById(formid);for (var i=0;i<items.length;++i){var dom =document.getElementById(items[i].name+"-errmsg");if(dom)dom.innerHTML ="";switch (items[i].type){case "hidden": case "text": case "textarea": reset_text_value(items[i]);break;case "select": reset_select_value(items[i]);break;case "radio": reset_radio_value(items[i]);break;case "checkbox": reset_checkbox_value(items[i]);break;}}this.fire("reset");};};MWT.extends(MWT.Form, MWT.Event);MWT.Tree=function(opt){this.listeners={};this.render=null;this.showRoot =false;if (opt){if (isset(opt.showRoot))this.showRoot=opt.showRoot;if (isset(opt.render))this.render=opt.render;}function isLeaf(node){return !isset(node.children);};function isExpand(node){if(isLeaf(node))return false;if(isset(node.expand)&& !node.expand)return false;return true;};this.togglenode =function(){var sub_tree_id ="sub-tree-"+$(this).data("sub-tree");if ($(this).hasClass("folder")){$(this).removeClass("folder");$(this).addClass("folder-open");$("#"+sub_tree_id).show();}else {$(this).removeClass("folder-open");$(this).addClass("folder");$("#"+sub_tree_id).hide();}};this.load=function(root){var prefixcode ="";var code ="<ul class='mwt-tree'>";if (this.showRoot){code +=this.display_tree_node(root, prefixcode);}else if (isset(root.children)){for (var i=0;i<root.children.length;++i){code +=this.display_tree_node(root.children[i], prefixcode);}}code +="</ul>";set_html(this.render, code);var thiso =this;$(".folder").click(thiso.togglenode);$(".folder-open").click(thiso.togglenode);$(".tree-node").click(function(){thiso.click_node($(this).data("node-id"));});};this.display_tree_node=function(node,prefix_code){var code="<li>"+ this.get_tree_node_prefix(prefix_code, node)+ this.get_tree_node(node);if (isset(node.children)){var hide="";if(!isExpand(node))hide="display:none";code +="<ul class='mwt-tree' id='sub-tree-"+node.node_id+"' style='"+hide+"'>";var pc =prefix_code+"<span style='padding-left:15px;'></span>";for (var i=0;i<node.children.length;++i){code +=this.display_tree_node(node.children[i], pc);}code +="</ul>";}code +="</li>";return code;};this.get_tree_node_prefix =function(prefix_code, node){var cls ="folder-open";if(isLeaf(node))cls="leaf";else if (!isExpand(node)){cls="folder";}return prefix_code+"<i class='icon "+cls+"' data-sub-tree='"+node.node_id+"'></i>";};this.get_tree_node =function(node){var code="<a href='javascript:void(0);' class='tree-node' id='tn-"+node.node_id+"' "+ "data-node-id='"+node.node_id+"' data-node-value='"+node.node_value+"'>"+node.node_name+"</a>";return code;};this.click_node =function(node_id){var sel =$("#tn-"+node_id);var param ={"node_id":node_id, "node_name":sel.html(), "node_value":sel.data("node-value")};this.clicked_node=param;this.fire("click-node");};};MWT.extends(MWT.Tree, MWT.Event);MWT.Bar=function(opt){this.listeners={};this.render=null;this.items=[];if(opt){if(opt.render)this.render=opt.render;if(opt.items)this.items=opt.items;}this.create=function(){var code="<div class='mwt-bar'><table><tr>";var hasexpand=false;for(var i=0;i<this.items.length;++i){var item=this.items[i];if(item=='->'){code+="<td width='100%'></td>";hasexpand=true;continue;}if(item=='-'){if(!hasexpand)code+="<td width='100%'></td>";code+="</tr></table><hr><table><tr>";hasexpand=false;continue;}if(isset(item.html)){code+="<td>"+item.html+"</td>";continue;}var type=isset(this.items[i].type)?this.items[i].type:"button";switch(type){case "select": case "radiobtn": code+=this.renderSelect(item,i);break;case "search": code+=this.renderSearch(item,i);break;case "datepicker": code+=this.renderDatepicker(item,i);break;case "daterangepicker": code+=this.renderDaterangepicker(item,i);break;case "button": default: code+=this.renderButton(item,i);break;}}if(!hasexpand)code+="<td width='100%'></td>";code+="</tr></table></div>";set_html(this.render, code);for(var i=0;i<this.items.length;++i){var type=isset(this.items[i].type)?this.items[i].type:"button";switch(type){case "select": code+=this.bundleSelect(this.items[i],i);break;case "radiobtn": code+=this.bundleRadiobtn(this.items[i],i);break;case "search": code+=this.bundleSearch(this.items[i],i);break;case "datepicker": this.bundleDatepicker(this.items[i],i);break;case "daterangepicker": this.bundleDaterangepicker(this.items[i],i);break;case "button": default: code+=this.bundleButton(this.items[i],i);break;}}};this.genid=function(item,i){if(isset(item.id)&&item.id!="")return item.id;return this.render+"_item_"+i;};this.renderSearch=function(item,i){var txtid=this.genid(item,i);var btnid=txtid+"btn";var width=isset(item.width)?item.width:200;var txtwidth=width-70;var cls=isset(item.class)?item.class:'mwt-search-primary';var txt=isset(item.label&&item.label!="")?item.label:"搜索";var value=isset(item.value)?item.value:"";var placeholder=isset(item.placeholder)?item.placeholder:"";var code='<td><div class="mwt-search '+cls+'" style="width:'+width+'px;">'+ '<div class="text">'+ '<input type="text" class="form-control" id="'+txtid+'" style="width:'+txtwidth+'px;" value="'+value+'" placeholder="'+placeholder+'">'+ '</div>'+ '<button class="submit" id="'+btnid+'">'+txt+'</button>'+ '</div>';return code;};this.bundleSearch=function(item,i){var id=this.genid(item,i);var btnid=id+"btn";if(isset(item.handler)){$("#"+btnid).click(item.handler);$("#"+id).change(item.handler);};};this.renderButton=function(item,i){var code="<td><button id='"+this.genid(item,i)+"'";if(isset(item.class))code+=" class=\""+item.class+"\"";else code+=" class=\"mwt-btn-primary\"";if(isset(item.style))code+=" style=\""+item.style+"\"";code+=">"+item.label+"</button></td>";return code;};this.bundleButton=function(item,i){var id=this.genid(item,i);if(isset(item.handler)){$("#"+id).click(function(){item.handler();});};};this.renderSelect=function(item,i){var code="<td>";if(isset(item.label)&&item.label!=""){code+="<label";if (isset(item.width))code+=" style='width:"+item.width+"px;'";code+=">"+item.label+":&nbsp;</label></td><td style='padding-left:0;'>";}code+="<div id='"+this.genid(item,i)+"div'></div></td>";return code;};this.bundleSelect=function(item,i){var field=new MWT.SelectField({render:this.genid(item,i)+"div", id:this.genid(item,i), options:item.options, value:item.value, cls:item.class, style:item.style });field.create();if(isset(item.handler)){field.on("change",item.handler);};};this.renderRadiobtn=function(item,i){var code="<td>";if(isset(item.label)&&item.label!=""){code+="<label";if (isset(item.width))code+=" style='width:"+item.width+"px;'";code+=">"+item.label+":&nbsp;</label></td><td style='padding-left:0;'>";}code+="<div id='"+this.genid(item,i)+"div'></div></td>";return code;};this.bundleRadiobtn=function(item,i){var field=new MWT.RadiobtnField({render:this.genid(item,i)+"div", id:this.genid(item,i), options:item.options, value:item.value, class:item.class, style:item.style });field.create();if(isset(item.handler)){field.on("change",item.handler);};};this.renderDatepicker=function(item,i){var code="<td>";if(isset(item.label)&&item.label!=""){code+="<label";if (isset(item.width))code+=" style='width:"+item.width+"px;'";code+=">"+item.label+":&nbsp;</label></td><td style='padding-left:0;'>";}code+="<div id='"+this.genid(item,i)+"div'></div></td>";return code;};this.bundleDatepicker=function(item,i){var field=new MWT.DatePicker({render:this.genid(item,i)+"div", id:this.genid(item,i), format:item.format?item.format:'yy-mm-dd' });field.create();if(isset(item.handler)){field.on("change",item.handler);};};this.renderDaterangepicker=function(item,i){var code="<td>";if(isset(item.label)&&item.label!=""){code+="<label";if (isset(item.width))code+=" style='width:"+item.width+"px;'";code+=">"+item.label+":&nbsp;</label></td><td style='padding-left:0;'>";}code+="<div id='"+this.genid(item,i)+"div'></div></td>";return code;};this.bundleDaterangepicker=function(item,i){var field=new MWT.DateRangePicker({render:this.genid(item,i)+"div", id:this.genid(item,i), float:item.float?item.float:"right", format:item.format?item.format:'yy/mm/dd' });field.create();if(isset(item.handler)){field.on("change",item.handler);};};};MWT.extends(MWT.Bar, MWT.Event);MWT.Grid=function(opt){this.listeners={};this.render=null;this.grid_div=null;this.grid_chkbox_id=null;this.grid_chkbox_name=null;this.page_div=null;this.store={};this._pagebar ={};this.pagebar=true;this.pageSize=10;this.tbar=null;this.cm={};this.cls="mwt-table";this.bordered=false;this.multiSelect=false;var thiso=this;if(opt){if(opt.render)this.render=opt.render;if(opt.cm)this.cm=opt.cm;if(opt.cls)this.cls=opt.cls;if(opt.store){this.store=opt.store;var thiso=this;this.store.on("load", function(s){thiso.display();});}if(isset(opt.pagebar))this.pagebar=opt.pagebar;if(isset(opt.pageSize))this.pageSize=opt.pageSize;if(isset(opt.multiSelect))this.multiSelect=opt.multiSelect;if(isset(opt.tbar))this.tbar=opt.tbar;if(opt.bordered)this.bordered=true;}this.create=function(){this.grid_div="grid_div_"+opt.render;this.page_div="page_div_"+opt.render;this.grid_chkbox_id=this.grid_div+"-chkbox-id";this.grid_chkbox_name=this.grid_div+"-chkbox";var code="<div class='mwt-grid'";if(this.tbar){code+="><div id='tbar_div_"+opt.render+"'></div>";}else{code+=" style='border-top:solid 0px #ccc;'>";}var columns=this.cm.getColumns();code+="<table class='tab";if(this.bordered)code+=" bordered";if(!this.pagebar)code+=" nobbar";code+="'>";code+="<thead><tr>";if(this.multiSelect)code+="<td style='width:20px;text-align:center;'>"+ "<input id='"+this.grid_chkbox_id+"' type='checkbox' "+ "onchange='set_checkbox_checked(\""+this.grid_chkbox_name+"\",this.checked);'/></td>";var len=columns.length;for(var i=0;i<len;++i){if (columns[i].hide){continue;}var width="";if (columns[i].width){width="width='"+columns[i].width+"'";}var tdid =this.grid_div+"-"+columns[i].dataIndex+"-"+i;code+="<td "+width+" id='"+tdid+"' name='"+this.grid_div+"-th' ";if (isset(columns[i].align))code+="align='"+columns[i].align+"' ";if (isset(columns[i].valign))code+="valign='"+columns[i].valign+"' ";if (isset(columns[i].style))code+="style='"+columns[i].style+"' ";if (columns[i].sort)code+="class='grid-sort' ";code+="data-id='"+columns[i].dataIndex+"'>"+columns[i].head+"</td>";}code+="</tr></thead><tbody id='"+this.grid_div+"'></tbody></table>";if(this.pagebar)code+="<div id='"+this.page_div+"' style='background:#efefef;padding:0px;'></div>";code+="</div>";set_html(this.render, code);this.initevent();if(this.tbar){var tbar=new MWT.Bar({render:"tbar_div_"+opt.render,"items":this.tbar});tbar.create();}if(this.pagebar){this._pagebar =new MWT.Pagebar({"store" : this.store, "render" : this.page_div, "pageSize": this.pageSize });}};this.getRecord=function(key,value){var idx=this.store.indexOf(key,value);if(idx<0||idx>=this.store.size()){return null;}return this.store.get(idx);};this.load=function(params){if (isset(params))this.store.baseParams =params;if (this.pagebar)this._pagebar.changePage(1);else this.store.load();};this.display=function(){if(!this.render){return;}if(!this.grid_div){this.create();}var columns=this.cm.getColumns();var len=columns.length;var html="";var size=this.store.size();for(var i=0;i<size;++i){var item=this.store.get(i);item.store_index =i;html+="<tr>";if(this.multiSelect)html+="<td align='center'><input name='"+this.grid_chkbox_name+"' value='"+i+"' type='checkbox'/></td>";for(var c=0;c<len;++c){if (columns[c].hide){continue;}var dataidx=columns[c].dataIndex;var v =item[dataidx];if (columns[c].render){var func=columns[c].render;v =func(v,item);}html+="<td ";var width="";if (columns[c].width){html+="width='"+columns[c].width+"' ";}if (isset(columns[c].align))html+="align='"+columns[c].align+"' ";if (isset(columns[c].valign))html+="valign='"+columns[c].valign+"' ";if (isset(columns[c].style)) html+="style='"+columns[c].style+"' ";html+=">"+v+"</td>";}html+="</tr>";}document.getElementById(this.grid_div).innerHTML=html;};this.getSelectedRecords=function(){var values=get_checkbox_values(this.grid_chkbox_name);var records=[];for(var i=0;i<values.length;++i){var item=this.store.get(values[i]);item.store_index=values[i];records.push(item);}return records;};this.initevent=function(){var columns=this.cm.getColumns();var len=columns.length;for(var i=0;i<len;++i){if (!columns[i].sort){continue;}var tdid =this.grid_div+"-"+columns[i].dataIndex+"-"+i;document.getElementById(tdid).onclick=function(){var idx =this.getAttribute("data-id");var sort =0;if(this.hasAttribute("data-sort"))sort=this.getAttribute("data-sort");sort=1-sort;this.setAttribute("data-sort",sort);var doms=document.getElementsByName(thiso.grid_div+"-th");for(var i=0;i<doms.length;++i){removeClass(doms[i],"grid-sort-asc");removeClass(doms[i],"grid-sort-desc");}addClass(this,(sort==1)?"grid-sort-asc":"grid-sort-desc");var dir=sort==1?"ASC":"DESC";thiso.store.baseParams["sort"]=idx;thiso.store.baseParams["dir"]=dir;thiso.load();}}};};MWT.extends(MWT.Grid, MWT.Event);MWT.Grid.ColumnModel=function(opt){this.columns=[];if(opt){this.columns=opt;}this.getColumns=function(){return this.columns;};};
